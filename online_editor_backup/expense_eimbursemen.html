<style>
    .h3-modal-transparent{
        width: 90%;
    }
    #apply_quota, #view_quota, #modify_quota{
        height: 32px;
        background: #2970ff;
        color: #ffffff;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s;
        display: none;
        vertical-align: middle;
        margin: 6px 0 6px 8px;
    }
    #apply_quota, #modify_quota{
        width: 100px;
    }
    #view_quota{
        width: 130px;
    }
    #apply_quota:hover, #view_quota:hover, #modify_quota:hover{
        opacity: 0.8;
    }
    #searchBox,#searchBox2,#searchBox3,#searchBoxGift{
        height: 32px;
        font-size: 20px;
    }
    #searchBox,#searchBox3,#searchBoxGift{
        margin: 25px 0px 25px 0;
        text-align: left
    }
    #searchBox2{
        height: 38px;
        margin: 10px 0;
    }
    #searchBoxGift .searchInputGift, #searchBoxGift .searchInputGift2{
        width: 35%;
        height: 32px;
        line-height: 32px;
        border: 1px solid #CECECE;
        border-radius: 4px;
        font-size: 14px;
        text-indent: 8px;
    }
    #searchBox .searchInput,#searchBox2 .searchInput2,#searchBox3 .searchInput4{
        width: 60%;
        height: 32px;
        line-height: 32px;
        border: 1px solid #CECECE;
        border-radius: 4px;
        font-size: 14px;
        text-indent: 8px;
    }
    #searchBox .searchInput::-webkit-input-placeholder,
    #searchBox2 .searchInput2::-webkit-input-placeholder,
    #searchBox3 .searchInput4::-webkit-input-placeholder,
    #searchBoxGift .searchInputGift::-webkit-input-placeholder,
    #searchBoxGift .searchInputGift2::-webkit-input-placeholder{
        color: #cecece;
    }
    #searchBox .searchInput::-moz-placeholder,
    #searchBox2 .searchInput2::-moz-placeholder,
    #searchBox3 .searchInput4::-moz-input-placeholder,
    #searchBoxGift .searchInputGift::-moz-input-placeholder,
    #searchBoxGift .searchInputGift2::-moz-input-placeholder{
        /* Mozilla Firefox 19+ */
        color: #cecece;
    }
    #searchBox .searchInput:-ms-input-placeholder,
    #searchBox2 .searchInput2:-ms-input-placeholder,
    #searchBox3 .searchInput4::-ms-input-placeholder,
    #searchBoxGift .searchInputGift::-ms-input-placeholder,
    #searchBoxGift .searchInputGift2::-ms-input-placeholder{
        /* Internet Explorer 10-11 */ 
        color: #cecece;
    }
    #searchBox .searchInput:hover,
    #searchBox2 .searchInput2:hover,
    #searchBox3 .searchInput4:hover,
    #searchBoxGift .searchInputGift:hover,#searchBoxGift .searchInputGift2:hover{
        border: 1px solid #4279FE;
    }
    #searchBox .searchBtn,#searchBox2 .searchBtn2,#searchBox3 .searchBtn3,#searchBoxGift .searchBtnGift{
        width: 66px;
        height: 32px;
        background-color: #2970ff;
        border-color: #2970ff;
        color: #FFFFFF;
        font-size: 14px;
        border: 0;
        padding: 6px 8px;
        border-radius: 4px;
        cursor: pointer;
        margin-left: 6px;
    }
    #searchBox .searchBtn:hover,
    #searchBox2 .searchBtn2:hover,
    #searchBox3 .searchBtn3:hover,
    #searchBoxGift .searchBtnGift:hover{
        opacity: 0.8;
    }
    .ant-modal-wrap .ant-modal-confirm-confirm{
        width:60% !important;
        height:600px !important;
    }
    .anticon-question-circle{
        display:none;
    }
    .bulletBox,.bulletBox2,.bulletBox3{
        width:90%;
        text-align: center;
        margin-right: 0;
    }
    .bulletBoxGift{
        text-align: center;
    }
    .bulletBoxGift th{
        white-space: nowrap;
        padding: 3px
    }
    .bulletBox,.bulletBox2,.bulletBox3,.bulletBoxGift tr{
        height:20%;
    }
    #page{
        margin:auto;
        text-align: center;
        margin: 20px 0;
        display:flex;
        align-items: center;
    }
    #pagecontent{
        height:32px;
        text-align: center;
        display: inline-block;
        list-style: none;
        vertical-align: middle;
        margin-bottom: 0
    }
    #page li{
        float: left;
        height:28px;
        text-align: center;
        line-height:28px;
        width:30px;
        border:1px solid #ddd;
        margin:2px;
        border-radius:5px;
        cursor: pointer;
    }
    .btn{
        line-height: 1.499;
        display: inline-block;
        font-weight: 400;
        text-align: center;
        touch-action: manipulation;
        cursor: pointer;
        background-image: none;
        border: 1px solid transparent;
        white-space: nowrap;
        padding: 0 15px;
        font-size: 14px;
        border-radius: 4px;
        height: 32px;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        -webkit-transition: all .3s cubic-bezier(.645,.045,.355,1);
        transition: all .3s cubic-bezier(.645,.045,.355,1);
        position: relative;
        box-shadow: 0 2px 0 rgba(0,0,0,.015);
        color: rgba(0,0,0,.65);
        background-color: #fff;
        border-color: #d9d9d9;
        display:none;
    }
    .btn:hover{
        border:1px solid #2970ff;
        color:#2970ff;
    }
    .fr{
        float:right;
    }
    .next{
        display:block;
    }
    #pagecontent .selected{
        border:1px solid #2970ff;
    }
</style>

<section id="toolbar"></section>

<section type="template" id="template">
<a-row>
    <a-col>
        <a-title key="title1594896224106" data-name="员工费用报销" data-name_i18n='{"en":"员工费用报销"}'></a-title>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-create-by key="creater" data-name="创建人"></a-create-by>
    </a-col>
    <a-col>
        <a-created-time key="createdTime" data-name="创建时间"></a-created-time>
    </a-col>
    <a-col>
        <a-sequence-no key="sequenceNo" data-name="单据号" data-prefix="FYBX"></a-sequence-no>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-user-selector key="user_name" data-name="经办人" data-name_i18n='{"en":"经办人"}' data-required-formula="'true'" data-dept-visible="user" data-default-value="null" data-default-value-type="originator" data-org-root="[]" data-mappings="employeeNo:{job_code};THREE_LEVEL,3:{company};departments:{department};"></a-user-selector>
    </a-col>
    <a-col>
        <a-text key="job_code" data-name="工号" data-data-item-name="job_code" data-required-formula="'true'"></a-text>
    </a-col>
    <a-col>
        <a-user-selector key="department" data-name="部门" data-data-item-name="department" data-required-formula="'true'" data-dept-visible="org" data-default-value="null" data-default-value-type="originatorDept" data-org-root="[]"></a-user-selector>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-user-selector key="company" data-name="所在公司" data-data-item-name="company" data-required-formula="'true'" data-dept-visible="org" data-default-value="null" data-org-root="[]"></a-user-selector>
    </a-col>
    <a-col>
        <a-text key="position" data-name="岗位" data-data-item-name="position" data-required-formula="'true'"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="car" data-name="车辆性质" data-visible="false" data-data-item-name="car"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="cost_select" data-name="成本中心" data-data-item-name="cost_select" data-required-formula="'true'" data-placeholder="请选择"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="recipient_bank" data-name="收方银行" data-data-item-name="recipient_bank" data-required-formula="'true'"></a-text>
    </a-col>
    <a-col>
        <a-text key="recipient_bank_code" data-name="收方银行账号" data-data-item-name="recipient_bank_code" data-required-formula="'true'"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-number key="apply_amount" data-name="申请金额(元)" data-data-item-name="apply_amount" data-display-formula="{creater} 为空" data-readonly-formula="true" data-format="percentile" data-compute-formula="sum({reimbursement_detail_total.review_amount})"></a-number>
    </a-col>
    <a-col>
        <a-text key="amount_cap" data-name="金额大写" data-data-item-name="amount_cap" data-display-formula="{creater} 为空" data-readonly-formula="true"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-textarea key="reimbursement_reason" data-name="报销事由" data-data-item-name="reimbursement_reason"></a-textarea>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-dropdown key="reimbursement_type" data-name="报销类型" data-data-item-name="reimbursement_type" data-required-formula="'true'" data-default-value="普通报销-非行政类" data-options="普通报销-非行政类;普通报销-行政类;普通报销-提成类;日清差旅报销;日清招待费;销售台量招待费;赠送报销"></a-dropdown>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-date key="apply_yearmonth" data-name="申请年月" data-data-item-name="apply_yearmonth" data-display-formula="{reimbursement_type} == '日清差旅报销' || {reimbursement_type} == '日清招待费' || {reimbursement_type} == '销售台量招待费' || {reimbursement_type} == '赠送报销' || {reimbursement_type} == '普通报销-非行政类' || {reimbursement_type} == '普通报销-行政类' || {reimbursement_type} == '普通报销-提成类'" data-required-formula="'true'" data-format="YYYY-MM"></a-date>
    </a-col>
    <a-col>
        <a-number key="days" data-name="天数" data-visible="false" data-data-item-name="days" data-display-formula="{reimbursement_type} == '日清差旅报销' || {reimbursement_type} == '日清招待费' || {reimbursement_type} == '销售台量招待费' || {reimbursement_type} == '赠送报销' || {reimbursement_type} == '普通报销-非行政类' || {reimbursement_type} == '普通报销-行政类' || {reimbursement_type} == '普通报销-提成类'" data-readonly-formula="true"></a-number>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-dropdown key="giftfee_type" data-name="赠送费用类型" data-data-item-name="giftfee_type" data-display-formula="{reimbursement_type} == '赠送报销'" data-required-formula="'true'" data-options="销售运费;油卡费用;其他费用;配件费用;中介费用"></a-dropdown>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="increase" data-name="是否已提升标准额度" data-visible="false" data-readonly-formula="true" data-default-value="否"></a-text>
    </a-col>
    <a-col>
        <a-radio key="judge_flag" data-name="是否通过校验" data-visible="false" data-data-item-name="judge_flag" data-default-value="是" data-options="是;否"></a-radio>
    </a-col>
</a-row>
<a-row>
    <a-col>
		<div>
            <button id="apply_quota" key="apply_quota" >
                <span>申请临时额度</span>
            </button>
            <button id="view_quota" key="view_quota" >
                <span>查看额度申请记录</span>
            </button>
            <button id="modify_quota" key="modify_quota">
                <span>修改申请金额</span>
            </button>
        </div>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="temporary" data-name="临时额度objectId" data-visible="false" data-data-item-name="temporary"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-attachment key="file" data-name="附件" data-data-item-name="file" data-limit="50M"></a-attachment>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-group-title key="group1595495763357" data-name="费用报销明细" data-expand="false"></a-group-title>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-sheet key="reimbursement_detail" data-name="费用报销明细" data-data-item-name="reimbursement_detail" data-rows="0" data-editable="false" data-importable="false" data-show-total="true" data-display-formula="{reimbursement_type} == '日清差旅报销' || {reimbursement_type} == '日清招待费' || {reimbursement_type} == '销售台量招待费' || {reimbursement_type} == '赠送报销'">
            <a-action-group>
            </a-action-group>
            <a-columns>
                <a-dropdown key="expenses_first" width="150" data-name="一级费用" data-data-item-name="expenses_first" data-readonly-formula="true" data-options="选项1;选项2;选项3" data-empty-value=""></a-dropdown>
                <a-dropdown key="expenses_second" width="150" data-name="二级费用" data-data-item-name="expenses_second" data-readonly-formula="true" data-options="选项1;选项2;选项3" data-empty-value=""></a-dropdown>
                <a-dropdown key="expenses_third" width="150" data-name="三级费用" data-data-item-name="expenses_third" data-readonly-formula="true" data-options="选项1;选项2;选项3" data-empty-value=""></a-dropdown>
                <a-number key="expenses_amount" width="150" data-name="标准额度" data-data-item-name="expenses_amount" data-readonly-formula="true" data-format="percentile"></a-number>
                <a-number key="review_amount" width="150" data-name="申请金额" data-data-item-name="review_amount" data-readonly-formula="true" data-format="percentile"></a-number>
                <a-text key="expenses_describe" width="150" data-name="费用描述" data-data-item-name="expenses_describe" data-readonly-formula="true" data-default-value=" "></a-text>
                <a-dropdown key="is_adopt" width="150" data-name="是否通过" data-data-item-name="is_adopt" data-options="是;否"></a-dropdown>
                <a-text key="reason" width="150" data-name="原因" data-data-item-name="reason" data-placeholder=""></a-text>
                <a-text key="model" width="150" data-name="机型" data-data-item-name="model" data-display-formula="{reimbursement_type} != '日清差旅报销' && {reimbursement_type} != '日清招待费'" data-readonly-formula="true"></a-text>
                <a-text key="category" width="150" data-name="产品名称" data-data-item-name="category" data-display-formula="{reimbursement_type} != '日清差旅报销' && {reimbursement_type} != '日清招待费'" data-readonly-formula="true"></a-text>
                <a-text key="brand" width="150" data-name="品牌" data-data-item-name="brand" data-display-formula="{reimbursement_type} != '日清差旅报销' && {reimbursement_type} != '日清招待费'" data-readonly-formula="true"></a-text>
                <a-text key="contract_no" width="150" data-name="合同号" data-data-item-name="contract_no" data-display-formula="{reimbursement_type} != '日清差旅报销' && {reimbursement_type} != '日清招待费'" data-readonly-formula="true"></a-text>
                <a-text key="salesman_name" width="150" data-name="业务员姓名" data-data-item-name="salesman_name" data-display-formula="{reimbursement_type} != '日清差旅报销' && {reimbursement_type} != '日清招待费'" data-readonly-formula="true"></a-text>
                <a-text key="customer_name" width="150" data-name="客户名称" data-data-item-name="customer_name" data-display-formula="{reimbursement_type} != '日清差旅报销' && {reimbursement_type} != '日清招待费'" data-readonly-formula="true"></a-text>
                <a-text key="product_number" width="150" data-name="机号" data-data-item-name="product_number" data-display-formula="{reimbursement_type} != '日清差旅报销' && {reimbursement_type} != '日清招待费'" data-readonly-formula="true"></a-text>
                <a-text key="deal_date" width="150" data-name="提机日期" data-data-item-name="deal_date" data-display-formula="{reimbursement_type} != '日清差旅报销' && {reimbursement_type} != '日清招待费'" data-readonly-formula="true"></a-text>
                <a-text key="product_id" width="150" data-name="产品id" data-data-item-name="product_id" data-readonly-formula="true"></a-text>
                <a-dropdown key="area" width="150" data-name="地区分类" data-data-item-name="area" data-display-formula="{reimbursement_type} != '销售台量招待费' && {reimbursement_type} != '赠送报销'" data-readonly-formula="true" data-default-value="三类地区" data-options="一类地区;二类地区;三类地区"></a-dropdown>
                <a-text key="real_date" width="150" data-name="日清时间" data-data-item-name="real_date" data-display-formula="{reimbursement_type} == '日清差旅报销'"></a-text>
                <a-text key="position_origin" width="150" data-name="出发地" data-data-item-name="position_origin" data-display-formula="{reimbursement_type} == '日清差旅报销'"></a-text>
                <a-text key="position_destination" width="150" data-name="到达地" data-data-item-name="position_destination" data-display-formula="{reimbursement_type} == '日清差旅报销'"></a-text>
                <a-number key="invoice_count" width="150" data-name="发票数量" data-visible="false" data-readonly-formula="true"></a-number>
                <a-text key="class_code" width="150" data-name="class_code" data-visible="false" data-data-item-name="class_code"></a-text>
                <a-text key="erp_code" width="150" data-name="科目代码" data-visible="false" data-data-item-name="erp_code"></a-text>
            </a-columns>
            <a-totals>
                <a-total key="stat-expenses_amount" column-key="expenses_amount" data-name="统计" data-data-item-name="" data-widget-type="" data-statistic-mode="sum" data-format="percentile"></a-total>
                <a-total key="stat-review_amount" column-key="review_amount" data-name="统计" data-data-item-name="" data-widget-type="" data-statistic-mode="sum" data-format="percentile"></a-total>
                <a-total key="stat-invoice_count" column-key="invoice_count" data-name="统计" data-data-item-name="" data-widget-type="" data-statistic-mode="sum" data-format="integer"></a-total>
            </a-totals>
        </a-sheet>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-group-title key="group1595495770658" data-name="费用报销合计"></a-group-title>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="erp_code" data-name="科目代码" data-visible="false" data-data-item-name="erp_code"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-sheet key="reimbursement_detail_total" data-name="费用报销合计" data-data-item-name="reimbursement_detail" data-rows="1" data-editable="false" data-importable="false" data-show-total="true">
            <a-action-group>
            </a-action-group>
            <a-columns>
                <a-association-form key="expenses_first" width="150" data-name="一级费用" data-name_i18n='{"en":"一级费用"}' data-schema-code="expenses_first" data-query-code="expenses_first" data-display-field="expenses_name" data-required-formula="'true'"></a-association-form>
                <a-association-form key="expenses_second" width="150" data-name="二级费用" data-name_i18n='{"en":"二级费用"}' data-schema-code="expenses_second" data-query-code="expenses_second" data-display-field="expenses_name" data-conditions="expenses_first:{reimbursement_detail_total.expenses_first}" data-mobile-conditions="expenses_first:{reimbursement_detail_total.expenses_first}" data-required-formula="'true'"></a-association-form>
                <a-association-form key="expenses_third" width="150" data-name="三级费用" data-name_i18n='{"en":"三级费用"}' data-schema-code="expenses_third" data-query-code="expenses_third" data-display-field="expenses_name" data-conditions="expenses_second:{reimbursement_detail_total.expenses_second}" data-mobile-conditions="expenses_second:{reimbursement_detail_total.expenses_second}" data-required-formula="'true'"></a-association-form>
                <a-number key="expenses_amount" width="150" data-name="标准额度" data-data-item-name="expenses_amount" data-format="percentile"></a-number>
                <a-number key="review_amount" width="150" data-name="申请金额" data-data-item-name="review_amount" data-required-formula="{reimbursement_type} 包含 '普通'" data-format="percentile"></a-number>
                <a-text key="expenses_describe" width="150" data-name="费用描述" data-data-item-name="expenses_describe"></a-text>
                <a-dropdown key="is_adopt" width="150" data-name="是否通过" data-data-item-name="is_adopt" data-options="是;否"></a-dropdown>
                <a-text key="reason" width="150" data-name="原因" data-data-item-name="reason" data-placeholder=""></a-text>
                <a-text key="model" width="150" data-name="机型" data-data-item-name="model" data-display-formula="{reimbursement_type} 不包含 '普通' && {reimbursement_type} != '日清差旅报销' && {reimbursement_type} != '日清招待费' && {reimbursement_type} != '销售台量招待费' && {reimbursement_type} != '赠送报销'"></a-text>
                <a-text key="category" width="150" data-name="产品名称" data-data-item-name="category" data-display-formula="{reimbursement_type} 不包含 '普通' && {reimbursement_type} != '日清差旅报销' && {reimbursement_type} != '日清招待费' && {reimbursement_type} != '销售台量招待费' && {reimbursement_type} != '赠送报销'"></a-text>
                <a-text key="brand" width="150" data-name="品牌" data-data-item-name="brand" data-display-formula="{reimbursement_type} 不包含 '普通' && {reimbursement_type} != '日清差旅报销' && {reimbursement_type} != '日清招待费' && {reimbursement_type} != '销售台量招待费' && {reimbursement_type} != '赠送报销'"></a-text>
                <a-text key="contract_no" width="150" data-name="合同号" data-data-item-name="contract_no" data-display-formula="{reimbursement_type} 不包含 '普通' && {reimbursement_type} != '日清差旅报销' && {reimbursement_type} != '日清招待费' && {reimbursement_type} != '销售台量招待费' && {reimbursement_type} != '赠送报销'"></a-text>
                <a-dropdown key="area" width="150" data-name="地区分类" data-data-item-name="area" data-display-formula="{reimbursement_type} 不包含 '普通' && {reimbursement_type} != '销售台量招待费' && {reimbursement_type} != '赠送报销'" data-default-value="三类地区" data-options="一类地区;二类地区;三类地区"></a-dropdown>
                <a-number key="invoice_count" width="150" data-name="发票数量" data-visible="false"></a-number>
                <a-text key="class_code" width="150" data-name="class_code" data-visible="false" data-data-item-name="class_code" data-display-formula="{reimbursement_type} 不包含 '普通'"></a-text>
                <a-number key="cumulative" width="150" data-name="累计数" data-visible="false" data-data-item-name="cumulative" data-display-formula="{reimbursement_type} 不包含 '普通'" data-default-value="1" data-placeholder=""></a-number>
                <a-text key="erp_code" width="150" data-name="科目代码" data-visible="false" data-data-item-name="erp_code"></a-text>
            </a-columns>
            <a-totals>
                <a-total key="stat-expenses_amount" column-key="expenses_amount" data-name="统计" data-data-item-name="" data-widget-type="" data-statistic-mode="sum" data-format="percentile"></a-total>
                <a-total key="stat-review_amount" column-key="review_amount" data-name="统计" data-data-item-name="" data-widget-type="" data-statistic-mode="sum" data-format="percentile"></a-total>
                <a-total key="stat-invoice_count" column-key="invoice_count" data-name="统计" data-data-item-name="" data-widget-type="" data-statistic-mode="sum" data-format="integer"></a-total>
                <a-total key="stat-Number1598006943677" column-key="cumulative" data-name="统计" data-data-item-name="" data-widget-type="" data-statistic-mode="sum" data-format="integer"></a-total>
            </a-totals>
        </a-sheet>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="is_adopt" data-name="差旅合计是否通过" data-visible="false" data-default-value="是"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="reason" data-name="差旅报销不通过原因" data-display-formula="{is_adopt} == '否'"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-group-title key="group1596636214803" data-name="以下ERP应付凭证信息由财务主办会计填写"></a-group-title>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-sheet key="reimbursement_erp" data-name="ERP应付凭证信息" data-data-item-name="reimbursement_erp" data-rows="1">
            <a-action-group>
            </a-action-group>
            <a-columns>
                <a-dropdown key="pk" width="150" data-name="PK" data-data-item-name="pk" data-default-value="40(借方)" data-options="40(借方);31(贷方);50(贷方);21(贷方);01(借方);11(贷方);70(借方)"></a-dropdown>
                <a-text key="expenses_introduce" width="150" data-name="费用说明" data-data-item-name="expenses_introduce"></a-text>
                <a-text key="ledger_account" width="150" data-name="总账科目" data-data-item-name="ledger_account"></a-text>
                <a-text key="subject" width="150" data-name="科目" data-data-item-name="subject"></a-text>
                <a-text key="commit_project" width="150" data-name="承诺项目" data-data-item-name="commit_project"></a-text>
                <a-text key="line_item" width="150" data-name="行项目文本" data-data-item-name="line_item"></a-text>
                <a-number key="amount" width="150" data-name="金额" data-data-item-name="amount" data-format="percentile"></a-number>
                <a-text key="job_code" width="150" data-name="员工号" data-data-item-name="job_code"></a-text>
                <a-dropdown key="tax" width="150" data-name="税" data-data-item-name="tax" data-default-value="J0" data-options="J0"></a-dropdown>
                <a-text key="cost_center_introduce" width="150" data-name="成本中心—说明" data-data-item-name="cost_center_introduce"></a-text>
                <a-text key="cost_center" width="150" data-name="成本中心" data-data-item-name="cost_center"></a-text>
                <a-text key="profit_center" width="150" data-name="利润中心" data-data-item-name="profit_center"></a-text>
                <a-text key="special_invoice_code" width="150" data-name="专用发票号" data-data-item-name="special_invoice_code"></a-text>
                <a-text key="order_code" width="150" data-name="订单" data-data-item-name="order_code"></a-text>
                <a-text key="serial_number" width="150" data-name="序列号" data-data-item-name="serial_number"></a-text>
                <a-text key="materiel" width="150" data-name="物料" data-data-item-name="materiel"></a-text>
                <a-text key="repair_code" width="150" data-name="维修单号" data-data-item-name="repair_code"></a-text>
            </a-columns>
        </a-sheet>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-radio key="if_general" data-name="是否生成台账凭证" data-data-item-name="if_general" data-default-value="否" data-options="是;否"></a-radio>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-sheet key="general_ledger_vouche" data-name="台帐凭证" data-data-item-name="reimbursement_erp" data-rows="1" data-display-formula="{if_general} == '是'">
            <a-action-group>
            </a-action-group>
            <a-columns>
                <a-text key="expenses_introduce" width="150" data-name="费用说明" data-data-item-name="expenses_introduce"></a-text>
                <a-text key="ledger_account" width="150" data-name="总账科目" data-data-item-name="ledger_account"></a-text>
                <a-text key="subject" width="150" data-name="科目" data-data-item-name="subject"></a-text>
                <a-text key="commit_project" width="150" data-name="承诺项目" data-data-item-name="commit_project"></a-text>
                <a-text key="line_item" width="150" data-name="行项目文本" data-data-item-name="line_item"></a-text>
                <a-number key="amount" width="150" data-name="金额" data-data-item-name="amount" data-format="percentile"></a-number>
                <a-text key="job_code" width="150" data-name="员工号" data-data-item-name="job_code"></a-text>
                <a-dropdown key="tax" width="150" data-name="税" data-data-item-name="tax" data-default-value="J0" data-options="J0" data-empty-value=" 请选择"></a-dropdown>
                <a-text key="cost_center_introduce" width="150" data-name="成本中心—说明" data-data-item-name="cost_center_introduce"></a-text>
                <a-text key="cost_center" width="150" data-name="成本中心" data-data-item-name="cost_center"></a-text>
                <a-text key="profit_center" width="150" data-name="利润中心" data-data-item-name="profit_center"></a-text>
                <a-text key="special_invoice_code" width="150" data-name="专用发票号" data-data-item-name="special_invoice_code"></a-text>
                <a-text key="order_code" width="150" data-name="订单" data-data-item-name="order_code"></a-text>
                <a-text key="serial_number" width="150" data-name="序列号" data-data-item-name="serial_number"></a-text>
                <a-text key="materiel" width="150" data-name="物料" data-data-item-name="materiel"></a-text>
                <a-text key="repair_code" width="150" data-name="维修单号" data-data-item-name="repair_code"></a-text>
                <a-dropdown key="pk" width="150" data-name="PK" data-data-item-name="pk" data-display-formula="{creater} 为空" data-default-value="40(借方)" data-options="40(借方);31(贷方);50(贷方);21(贷方);01(借方);11(贷方);70(借方)"></a-dropdown>
            </a-columns>
        </a-sheet>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-group-title key="group1595320200692" data-name="以下资金付款信息由财务主办会计填写"></a-group-title>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-dropdown key="query_type" data-name="查询类型" data-data-item-name="query_type" data-required-formula="'true'" data-default-value="员工供应商" data-options="员工供应商;供应商;客户"></a-dropdown>
    </a-col>
    <a-col>
        <a-text key="company_name" data-name="对方单位名称" data-data-item-name="company_name" data-placeholder="" data-max-length="64"></a-text>
    </a-col>
    <a-col>
        <a-text key="serial_number" data-name="供应商/客户代码" data-data-item-name="serial_number"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-association-form key="fund_plan_project" data-name="资金计划项目代码" data-visible="false" data-data-item-name="fund_plan_project" data-schema-code="fund_plan_project" data-query-code="fund_plan_project" data-display-field="code" data-mappings="code:{fund_plan_project_mapping};plan_name:{fund_plan_project_name}"></a-association-form>
    </a-col>
    <a-col>
        <a-text key="fund_plan_project_name" data-name="资金计划项目名称" data-visible="false" data-data-item-name="fund_plan_project_name"></a-text>
    </a-col>
    <a-col>
        <a-text key="fund_plan_project_mapping" data-name="资金计划项目代码映射" data-visible="false" data-data-item-name="fund_plan_project_mapping"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="pay_bank" data-name="付方银行" data-data-item-name="pay_bank"></a-text>
    </a-col>
    <a-col>
        <a-text key="pay_bank_code" data-name="付方银行账号" data-data-item-name="pay_bank_code"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="company_code" data-name="公司代码" data-visible="false" data-data-item-name="company_code" data-required-formula="'true'"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-number key="actual_amount" data-name="实际支付金额" data-data-item-name="actual_amount" data-format="RMB.percentile"></a-number>
    </a-col>
    <a-col>
        <a-text key="amount_capitalize" data-name="金额大写" data-data-item-name="amount_capitalize" data-readonly-formula="true" data-placeholder=" "></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-radio key="division_approval" data-name="是否暂存过(勿删)" data-visible="false" data-data-item-name="division_approval" data-default-value="否" data-options="是;否"></a-radio>
    </a-col>
    <a-col>
        <a-radio key="group_approval" data-name="是否财务主办会计已同意（勿删）" data-visible="false" data-data-item-name="group_approval" data-default-value="否" data-options="是;否"></a-radio>
    </a-col>
    <a-col>
        <a-radio key="is_urgent" data-name="是否加急" data-visible="false" data-default-value="否" data-options="是;否"></a-radio>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-textarea key="introduction" data-name="摘要" data-data-item-name="introduction"></a-textarea>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="payment_reference" data-name="付款参考(机型机号)" data-data-item-name="payment_reference"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-group-title key="group1595320222852" data-name="SAP凭证回执信息"></a-group-title>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="msgcode" data-name="ERP消息码" data-data-item-name="msgcode" data-readonly-formula="true" data-placeholder=""></a-text>
    </a-col>
    <a-col>
        <a-text key="erpcode" data-name="ERP凭证编号" data-data-item-name="erpcode" data-readonly-formula="true" data-placeholder=""></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-textarea key="erpreadin" data-name="ERP消息" data-data-item-name="erpreadin"></a-textarea>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="erptype" data-name="ERP凭证参照" data-visible="false" data-data-item-name="erptype" data-readonly-formula="true" data-placeholder=""></a-text>
    </a-col>
    <a-col>
        <a-text key="erptext" data-name="ERP凭证消息" data-visible="false" data-data-item-name="erptext" data-readonly-formula="true" data-placeholder=""></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-group-title key="group1599810245287" data-name="SAP台账回执信息"></a-group-title>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="msgcodetai" data-name="ERP消息码" data-data-item-name="msgcodetai" data-display-formula="{if_general} == '是'"></a-text>
    </a-col>
    <a-col>
        <a-text key="erpcodetai" data-name="ERP台账编号" data-data-item-name="erpcodetai" data-display-formula="{if_general} == '是'"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-textarea key="erpreadintai" data-name="ERP消息" data-data-item-name="erpreadintai" data-display-formula="{if_general} == '是'"></a-textarea>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="erptypetai" data-name="ERP台账参照" data-visible="false" data-data-item-name="erptypetai" data-display-formula="{if_general} == '是'"></a-text>
    </a-col>
    <a-col>
        <a-text key="erptexttai" data-name="ERP台账消息" data-visible="false" data-data-item-name="erptexttai" data-display-formula="{if_general} == '是'"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-modified-time key="modifiedTime" data-name="审批时间" data-visible="false"></a-modified-time>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-group-title key="group1595320243662" data-name="资金回执信息"></a-group-title>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="resp_code" data-name="资金系统返回指令信息" data-data-item-name="resp_code"></a-text>
    </a-col>
    <a-col>
        <a-text key="srcserialno" data-name="资金系统返回来源单据流水号" data-data-item-name="srcserialno" data-readonly-formula="true"></a-text>
    </a-col>
    <a-col>
        <a-text key="notecode" data-name="资金系统返回流水号" data-data-item-name="notecode" data-readonly-formula="true"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="paymadedate" data-name="资金返回支付确认日期" data-data-item-name="paymadedate" data-readonly-formula="true"></a-text>
    </a-col>
    <a-col>
        <a-text key="payinfo" data-name="资金返回支付信息" data-data-item-name="payinfo" data-readonly-formula="true"></a-text>
    </a-col>
    <a-col>
        <a-text key="smbtext" data-name="资金支付返回title" data-data-item-name="smbtext" data-readonly-formula="true"></a-text>
    </a-col>
</a-row>
</section>

<script src="https://cdn.bootcdn.net/ajax/libs/jquery/1.10.0/jquery.min.js"></script>

<script id="customScript">
    (function(form){
        var isMobile = false;
        var tablelist = [];
        var tablelist2 = [];
        var tablelist3 = [];
        var tablelistGift = [];
        var tableGiftType = {};
        var checkedValue = "";
        var checkedValue2 = "";
        var checkedValue3 = "";
        var checkedCode = "";
        var checkedCode2 = "";
        var checkedCode3 = "";
        var checkedCode4 = "";
        var checkedCode5 = "";
        var procStatus = ""; //全局的状态
        var count = 0;
        var pagesize = 5; //每页显示的数量
        var pagenum = 5; //显示的页码数量
        var pageindex = 1;
        var pagecontent;
        var prev;
        var next;
        var checkedIds = ""; // 翻页保存选中的id
        var checkVal = [];
        var costSelect = {};
        /**
         * 用户自定义JS区域
         */

        // 日清招待费 start
        function getReimDetailByMonth(code, year, month){
            if(month < 10){
                month = '0' + month
            }
            // 获取报销明细
            return axios({
                method: 'get',
                url: `http://sycrm.sonyu.cn:8899/api/SYCRM_GET_ENTERTAIN_TO_DINGTALK/ssss/${ code }/${ year }/${ month }`,
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'Authorization': 'JWT eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1NTY0MzE1OTMsImlzcyI6InNvbnl1IiwiZGF0YSI6eyJ1aWQiOiJTWTAwMDc4NyJ9fQ.GMcYJgG8I1ZuU84fwnL8rGJ-fly2FFjMkb9zjoX1ZL0'
                },
            })
        }
        function getIdsBySizeRes(sums){
            // 根据明细res.sums获取ids
            return axios.get('http://113.12.64.58:88/api/ext/v1/expenses/getIdAndErp_code', { params: sums })
        }
        // 给主表自定义申请额度按钮添加样式
        function setStyle(){
            let apply_quota_node = window.document.getElementById('apply_quota');
            let apply_quota_parent_node = apply_quota_node.parentNode;
            apply_quota_parent_node.style = "border-bottom: 1px solid #d9d9d9";
        }
        // 给申请额度按钮添加事件进行跳转页面
        function applyQuota(objectId){
            let applyQuotaNode = window.document.getElementById('apply_quota');
            let flowCode = "quota_application";
            let baseUrl = '';
            let endUrl = '';
            let parentId = '';
            if(isMobile){
                baseUrl = window.location.origin + window.location.pathname;
                endUrl = `${baseUrl}/#/form/detail?startWorkflowCode=${flowCode}&return=/apps/apps-form-list/${flowCode}?objectId=${objectId}&type=1`;
            }else{
                parentId = window.location.search.indexOf('parentId') > -1 ? window.location.search.split('%3D')[1].split('%')[0] : '';
                baseUrl = window.location.origin + window.location.pathname;
                endUrl = `${baseUrl}?startWorkflowCode=${flowCode}&return=/application/sonyu_mechanics/application-list/${flowCode}?parentId=${parentId}&code=${flowCode}&openMode&pcUrl&queryCode=&iframeAction=add?objectId=${objectId}&type=1`;
            }
            applyQuotaNode.onclick = function(){
                // window.open(endUrl, '_blank');
                // window.close();
                window.location.href = endUrl;
            }
        }
        // 给申请额度按钮添加隐藏方法，根据费控校验未通过和是否已提升额度来控制隐藏
        function showApplyQuota(self, isIncrease, isPass){
            // isIncrease 是否已提升临时额度;
            // isPass 费控校验状态; 费控接口校验为通过：隐藏；不通过：显示;
            let applyQuotaNode = window.document.getElementById('apply_quota');
            let viewQuotaNode = window.document.getElementById('view_quota');
            let modifyQuotaNode = window.document.getElementById('modify_quota');
            if(isIncrease === '是'){
                applyQuotaNode.style = "display: none";
                modifyQuotaNode.style = "display: none";
                viewQuotaNode.style = 'display: inline-block';
                self.increase.options.visible = true;
            }else if(isIncrease === '否' && isPass === '否'){
                applyQuotaNode.style = "display: inline-block";
                self.increase.options.visible = true;
                if(self.reimbursement_type.value === '普通报销-非行政类' || self.reimbursement_type.value === '普通报销-行政类' || self.reimbursement_type.value === '普通报销-提成类'){
                    modifyQuotaNode.style = "display: none";
                }else{
                    modifyQuotaNode.style = "display: inline-block";
                }
                viewQuotaNode.style = 'display: none';
            }else if(isIncrease === '否' && isPass === '是'){
                applyQuotaNode.style = "display: none";
                modifyQuotaNode.style = "display: none";
                viewQuotaNode.style = 'display: none';
            }
        }
        // 给修改申请金额按钮添加事件进行修改明细子表申请金额
        function modifyQuota(self){
            let modifyQuotaNode = window.document.getElementById('modify_quota');
            modifyQuotaNode.onclick = function(){
                self.$confirm({
                    title: '修改申请金额与标准额度一致',
                    content: '是否按照费控标准进行报销？',
                    okText: '确认',
                    cancelText: '我再想想',
                    onOk: function(){
                        let loading = self.$message.loading('请稍等...', 0);
                        let detailDatas = self.reimbursement_detail.value;
                        let errorDetail = []; // 暂存所有为否的数据
                        let errorNames = []; // 暂存所有为否的第三级科目名称
                        let singleNames = []; // 第三级科目名称去重后
                        detailDatas.forEach((item, index) => {
                            if(item.is_adopt === '否'){
                                errorDetail.push({
                                    expenses_amount: item.expenses_amount,
                                    index: index,
                                    expenses_third: item.expenses_third
                                });
                                errorNames.push(item.expenses_third);
                            }
                        });
                        singleNames = [...new Set(errorNames)];
                        if(errorDetail && errorDetail.length > 0){
                            for(let i = 0;i < errorDetail.length;i++){
                                self.reimbursement_detail.rows[errorDetail[i].index].value = {
                                    review_amount: errorDetail[i].expenses_amount,
                                    is_adopt: '是',
                                    reason: '已手动修改申请金额'
                                };
                            }
                        }
                        let newErrorDetail = [];
                        let newDetailDatas = self.reimbursement_detail.value;
                        if(singleNames && singleNames.length > 0){
                            for(let k = 0;k < singleNames.length;k++){
                                for(let l = 0;l < newDetailDatas.length;l++){
                                    if(singleNames[k] === newDetailDatas[l].expenses_third){
                                        newErrorDetail.push({
                                            expenses_third: newDetailDatas[l].expenses_third,
                                            review_amount: newDetailDatas[l].review_amount
                                        });
                                    }
                                }
                            }
                            let newErrorDetailEnd = [];
                            for(let m = 0;m < singleNames.length;m++){
                                let amount = 0;
                                for(let n = 0;n < newErrorDetail.length;n++){
                                    if(singleNames[m] === newErrorDetail[n].expenses_third){
                                        amount += newErrorDetail[n].review_amount;
                                    }
                                }
                                newErrorDetailEnd.push({
                                    expenses_third: singleNames[m],
                                    amount: amount
                                })
                            }
                            for(let x = 0;x < newErrorDetailEnd.length;x++){
                                for(let y = 0;y < self.reimbursement_detail_total.value.length;y++){
                                    if(newErrorDetailEnd[x].expenses_third === self.reimbursement_detail_total.value[y].expenses_third.expenses_name){
                                        self.reimbursement_detail_total.rows[y].value = {
                                            review_amount: newErrorDetailEnd[x].amount,
                                            is_adopt: '是',
                                            reason: '已手动修改申请金额'
                                        }
                                    }
                                }
                            }
                        }
                        let modifyTotal = self.reimbursement_detail_total.value;
                        modifyTotal.forEach((item, index) => {
                            if(item.expenses_amount && item.is_adopt === '否'){
                                self.reimbursement_detail_total.rows[index].value = {
                                    review_amount: item.expenses_amount,
                                    is_adopt: '是',
                                    reason: '已手动修改申请金额'
                                }
                            }
                        })
                        loading();
                        self.$message.success('修改成功');
                    },
                    onCancel: function(){
                        console.log('我再想想');
                    }
                })
            }
        }
        // 给查看额度申请记录按钮添加事件进行跳转页面
        function viewQuota(temporary){
            if(temporary !== ''){
                let viewQuotaNode = window.document.getElementById('view_quota');
                // 页面跳转所需的三个id
                let workitemId = '';
                let workflowInstanceId = '';
                let parentId = '';
                viewQuotaNode.onclick = function(){
                    console.log('查看记录去');
                    axios.get('http://113.12.64.58:88/api/ext/v1/quota/getId?temporary=' + temporary).then(res=>{
                        console.log(res, 'resresres');
                        if(res && res.errcode === 0){
                            workitemId = res.data.workitemId;
                            workflowInstanceId = res.data.workflowInstanceId;
                            parentId = res.data.parentId;
                        }
                    }).then(()=>{
                        let baseUrl = '';
                        let endUrl = '';
                        if(isMobile){
                            baseUrl = window.location.origin + window.location.pathname;
                            endUrl = `${baseUrl}/#/form/detail?workitemId=${workitemId}&workflowInstanceId=${workflowInstanceId}&isWorkFlow=true&return=/apps/apps-form-list/quota_application`;
                        }else{
                            baseUrl = window.location.origin + window.location.pathname;
                            endUrl = `${baseUrl}?workitemId=${workitemId}&workflowInstanceId=${workflowInstanceId}&isWorkFlow=true&return=/application/songyu_mechanics/application-list/quota_application?parentId=${parentId}&code=quota_application&openMode&pcUrl&queryCode=&iframeAction=detail`;
                        }
                        window.open(endUrl, '_blank');
                    }).catch(e=>{
                        self.$message.error(e);
                    });
                }
            }
        }
        // 日清招待费 end
        // 云枢OA会计科目查询接口:  http://113.12.64.58:8010/sap/bc/ZCL_FI_YS_KJKM?sap-client=300&sap-language=ZH
        function getSapData(self, code, type, resSum, regParam, where){
            // code: 输入框内容(科目代码或模糊字段)
            let paramData = {};
            let companyCode = self.company_code.value; // 公司代码
            if(code && /^\d+$/.test(code)){
                paramData = {
                    'BUKRS': companyCode,
                    'SAKNR': code
                }
            }else if(code && !/^\d+$/.test(code)){
                paramData = {
                    'BUKRS': companyCode,
                    'TXT50': code
                }
            }else{
                paramData = {
                    'BUKRS': companyCode
                }
            }
            axios({
                method: 'post',
                url: 'http://113.12.64.58:88/sap/bc/ZCL_FI_YS_KJKM?sap-client=800&sap-language=ZH',
                headers: {
                    'sap-user': 'IF_USER',
                    'sap-password': 'sy123456',
                },
                data: paramData
            }).then(res=>{
                if(res && res.DETAILS.length){
                    tablelist = res.DETAILS;
                    if(code && type){
                        if(res && res.DETAILS.length){
                            if(where === 1){
                                let renderLength = self.reimbursement_detail_total.value.length;
                                let arr5 = new Array(renderLength);
                                for(let i = 0;i < renderLength;i++){
                                    arr5[i] = {
                                        expenses_introduce: res.DETAILS[i].TXT50,
                                        ledger_account: res.DETAILS[i].SAKNR,
                                        amount: resSum,
                                        job_code: self.job_code.value,
                                        line_item: self.user_name.value[0].name + '-' + regParam[0].secondName,
                                        commit_project: self.reimbursement_detail_total.value[i].erp_code
                                    }
                                }
                                self.general_ledger_vouche.value = arr5;
                                let lastIndex = self.reimbursement_detail_total.value.length;
                                self.general_ledger_vouche.insertRow(lastIndex, {});
                                self.general_ledger_vouche.rows[lastIndex].value = {
                                    pk: '31(贷方)',
                                    expenses_introduce: '其它应付款-员工',
                                    ledger_account: '2241040000',
                                    subject: self.job_code.value,
                                    amount: resSum
                                }
                            }else{
                                self.reimbursement_erp.rows[0].value = {
                                    expenses_introduce: res.DETAILS[0].TXT50,
                                    ledger_account: res.DETAILS[0].SAKNR,
                                    amount: resSum,
                                    job_code: self.job_code.value,
                                    line_item: self.user_name.value[0].name + '-' + regParam[0].secondName,
                                    cost_center_introduce: costSelect ? costSelect.cost_center_introduce : '',
                                    cost_center: costSelect ? costSelect.cost_center : '',
                                    profit_center: costSelect ? costSelect.profit_center : '',
                                    commit_project: self.reimbursement_detail_total.value[0].erp_code
                                }
                                let lastIndex = self.reimbursement_detail_total.value.length;
                                self.reimbursement_erp.insertRow(lastIndex, {});
                                self.reimbursement_erp.rows[lastIndex].value = {
                                    pk: '31(贷方)',
                                    expenses_introduce: '其它应付款-员工',
                                    ledger_account: '2241040000',
                                    subject: self.job_code.value,
                                    amount: resSum
                                }
                            }
                        }else{
                            self.$message.error('接口返回异常');
                        }
                    }else if(code && !type){
                        dataChange1(self, code);
                    }else{
                        dataChange1(self);
                    }
                }else{
                    if(self.company_code.value){
                        self.$message.error(res.MESSAGE);
                    }else{
                        self.$message.error('未获取到公司代码，请检查部门和所在公司');
                    }
                }
            }).catch(e=>{
                console.log(e);
                self.$message.error(e);
            });
        }
        // 云枢OA成本中心查询接口: http://113.12.64.58:8010/sap/bc/ZCL_FI_YS_CBZX?sap-client=300&sap-language=ZH
        function getSapData2(self, type, code, where){
            let paramData = {};
            let companyCode = self.company_code.value;
            // type: 类型 true:成本中心 false:利润中心
            // code: 成本中心编码或利润中心编码
            if(type){
                if(code && /^\d+$/.test(code)){
                    paramData = {
                        'BUKRS': companyCode,
                        'KOSTL': code
                    }
                }else if(code && !/^\d+$/.test(code)){
                    paramData = {
                        'BUKRS': companyCode,
                        'LTEXT': code
                    }
                }else{
                    paramData = {
                        'BUKRS': companyCode
                    }
                }
            }else{
                if(code && /^\d+$/.test(code)){
                    paramData = {
                        'BUKRS': companyCode,
                        'PRCTR': code
                    }
                }else if(code && !/^\d+$/.test(code)){
                    paramData = {
                        'BUKRS': companyCode,
                        'MCTXT': code
                    }
                }else{
                    paramData = {
                        'BUKRS': companyCode,
                    }
                }
            }
            axios({
                method: 'post',
                url: 'http://113.12.64.58:88/sap/bc/ZCL_FI_YS_CBZX?sap-client=800&sap-language=ZH',
                headers: {
                    'sap-user': 'IF_USER',
                    'sap-password': 'sy123456',
                },
                data: paramData
            }).then(res=>{
                if(res && res.DETAILS.length){
                    tablelist2 = res.DETAILS;
                    if(where === 1){
                        if(code){
                            dataChange2(self, type, code);
                        }else{
                            dataChange2(self, type);
                        }
                    }else{
                        if(code){
                            dataChange2(self, type, code);
                        }else{
                            dataChange2(self, type);
                        }
                    }
                }else{
                    if(self.company_code.value){
                        self.$message.error(res.MESSAGE);
                    }else{
                        self.$message.error('未获取到公司代码，请检查部门和所在公司');
                    }
                }
            }).catch(e=>{
                console.log(e);
                self.$message.error(e);
            });
        }
        // 云枢OA供应商与客户查询接口: http://113.12.64.58:8010/sap/bc/ZCL_FI_YS_GYSKH?sap-client=300&sap-language=ZH
        function getSapData3(self, type, code){
            let typeTrans = "";
            let paramData = {};
            let companyCode = self.company_code.value;
            switch(type){
                case '员工供应商':
                typeTrans = 'E';
                break;
                case '供应商':
                typeTrans = 'S';
                break;
                case '客户':
                typeTrans = 'C';
                break;
            }
            // code: 编号
            if(code && /^\d+$/.test(code)){
                paramData = {
                    'BUKRS': companyCode,
                    'QTYPE': typeTrans,
                    'CID': code
                }
            }else if(code && !/^\d+$/.test(code)){
                paramData = {
                    'BUKRS': companyCode,
                    'QTYPE': typeTrans,
                    'NAME': code
                }
            }else{
                paramData = {
                    'BUKRS': companyCode,
                    'QTYPE': typeTrans
                }
            }
            axios({
                method: 'post',
                url: 'http://113.12.64.58:88/sap/bc/ZCL_FI_YS_GYSKH?sap-client=800&sap-language=ZH',
                headers: {
                    'sap-user': 'IF_USER',
                    'sap-password': 'sy123456',
                },
                data: paramData
            }).then(res=>{
                if(res && res.DETAILS.length){
                    tablelist3 = res.DETAILS;
                    if(code){
                        dataChange3(self, code);
                    }else{
                        dataChange3(self);
                    }
                }else{
                    if(self.company_code.value){
                        self.$message.error(res.MESSAGE);
                    }else{
                        self.$message.error('未获取到公司代码，请检查部门和所在公司');
                    }
                }
            })
        }
        function circlePostSap(self, i, code){
            let paramData = {};
            let companyCode = self.company_code.value;
            if(companyCode){
                paramData = {
                    'BUKRS': companyCode,
                    'SAKNR': code
                }
                axios({
                    method: 'post',
                    url: 'http://113.12.64.58:88/sap/bc/ZCL_FI_YS_KJKM?sap-client=800&sap-language=ZH',
                    headers: {
                        'sap-user': 'IF_USER',
                        'sap-password': 'sy123456',
                    },
                    data: paramData
                }).then(res=>{
                    if(res && res.DETAILS.length){
                        self.reimbursement_erp.rows[i].value = {
                            expenses_introduce: res.DETAILS[0].TXT50,
                            ledger_account: code
                        }
                    }else{
                        self.$message.error(res.MESSAGE);
                    }
                })
            }else{
                self.$message.error('未获取到公司代码，请检查部门和所在公司');
            }
        }
        // 绘制赠送报销点击弹框内容
        function dataChangeGift(self, giftType, code){
            let giftTypeCode = regGiftType(giftType);
            // 分页按钮
            const paginationBox=
            `<div id="page">
                <button id="prev" class="btn next fr">上一页</button>
                <ul id="pagecontent">
                    <li class="selected">1</li>
                    <li>2</li>
                </ul>
                <button id="next" class="btn next fr">下一页</button>
            </div>`;
            // table主体
            const datalistGift = tablelistGift.map((item, index) => {
                if(index < 15){
                    // return '<tr style="background:' + checkedIds.split(',').includes(item.id) ? 'rgb(65, 105, 225)' : 'white' + '">'+
                    return `<tr style="background-color:${checkedIds.split(',').includes(item.id + '') ? 'rgb(65, 105, 225)' : 'white' }">`+
                // 　　　　　　'<th>'+'<input type="checkbox" name="checkbox" id="chenckedId' + index +'"  value="'+ item.id +'"/>'+'</th>'+
                            `<th><div  class="checkbox">${item.id}<div></th>` +
                　　　　　　'<th>'+item.customer_name+'</th>'+
            　　　　　　    '<th>'+item.company_name+'</th>'+
                            '<th>'+item[giftTypeCode]+'</th>'+
                　　　　　　'<th>'+item.retain_user_name+'</th>'+
                            '<th>'+item.contract_no+'</th>'+
                            '<th>'+item.main_product_type+'</th>'+
                            '<th>'+item.main_product_brand+'</th>'+
                            '<th>'+item.main_product_classify+'</th>'+
                            '<th>'+item.main_product_model+'</th>'+
                            '<th>'+item.main_product_number+'</th>'+
                            '<th>'+item.base_status+'</th>'+
                            '<th>'+item.deal_date+'</th>'+
                            '<th>'+item.gift+'</th>'+
                        '</tr>';
                }
            }).join('')
            // table的表头
            const bulletBoxGift =
            `<table id="tb" class="bulletBoxGift" border="1" frame=box>
                <thead>
                    <tr>
                        <th>订单ID</th>
                        <th>客户姓名</th>
                        <th>公司名称</th>
                        <th>${giftType}</th>
                        <th>业务员</th>
                        <th>合同号</th>
                        <th>产品类型</th>
                        <th>品牌</th>
                        <th>产品类别</th>
                        <th>机型</th>
                        <th>机号</th>
                        <th>订单状态</th>
                        <th>提机日期</th>
                        <th>赠送备注</th>
                    </tr>
                </thead>
                <tbody>
                    ${datalistGift}
                </tbody>
            </table>`;
            const querySearchGift =
            `<div id="searchBoxGift">
                <input type="text" value="${code ? code : ''}" class="searchInputGift" placeholder="合同号" />
                <input type="text" value="${code ? code : ''}" class="searchInputGift2" placeholder="业务员姓名" />
                <button class="searchBtnGift" type="button">查 询</button>
            </div>`;
            function getPagecontentDom(){
                //拿到上一页下一页和分页盒子的dom操作节点
                pagecontent = window.document.getElementById('pagecontent');
                prev = window.document.getElementById('prev');
                next = window.document.getElementById('next');
                if(pagecontent){
                    createPage();
                }else{
                    setTimeout(getPagecontentDom, 100)
                }
            }
            function getMobileContentGift(){
                var isMtableBox = window.document.getElementsByClassName('h3-modal-alert-content')[0];
                if(isMtableBox){
                    window.clearTimeout(tx);
                    isMtableBox.innerHTML = querySearchGift + '<div style="overflow-x: scroll">' +  bulletBoxGift + '</div>' + paginationBox;
                }else{
                    var tx = setTimeout(getMobileContentGift, 100);
                }
            }
            if(isMobile){
                getMobileContentGift();
            }else{
                var tableBox = window.document.getElementsByClassName('tableBox')[0];
                tableBox.innerHTML = querySearchGift + '<div style="overflow-x: scroll">' + bulletBoxGift + '</div>' + paginationBox;
            }
            // if(!isMobile){
                pagecontent = window.document.getElementById('pagecontent');
                prev = window.document.getElementById('prev');
                next = window.document.getElementById('next');
                createPage();
            // }
            function createPage(){
                //向上取整,总共显示多少页
                var pageCount=Math.ceil(count/pagesize);
                var start=1;
                var end=pageCount;
                //如果点击前两个页码，那么显示的就是前两个
                if(pageindex<pagenum/2){
                    start=1;
                    //如果总数大于每页显示的数量，就显示每页显示的数量，如果总数小于每页显示的数量，那么就显示总数
                    end=pagenum>pageCount?pageCount:pagenum;
                }
                //如果点击的是后面两个
                if(pageindex>pagenum/2){
                    //第一个显示的页码就是2 、 3 、 4 、 5 、 6//点击4，显示的第一个数就是4-2
                    start=pageindex-Math.floor(pagenum/2);
                    //点击4，最后一个数显示的就应该是4+2
                    end=pageindex+Math.floor(pagenum/2)
                }
                //当总共有10页的时候，点击9，仍然显示6 、7 、8 、9  、10
                if(pageindex>pageCount-Math.floor(pagenum/2)){
                    start = pageCount - pagenum + 1;//开始就是10-5+1=6
                    end=pageCount;
                }
                start = start > 1 ? start : 1;
                end = end > pageCount ? pageCount : end;
                pagecontent.innerHTML="";
                for(var i = start;i <= end;i++){
                    var li = document.createElement('li');
                    li.innerHTML=i;
                    li.index=i;
                    if(i==pageindex){
                        li.className="selected";
                    }
                    li.onclick=function(){
                        pageindex=this.index;
                        createPage();
                        // 分页的时候判断是不是选中状态
                        postGiftFeeData(self, self.giftfee_type.value, pageindex, pagesize, 1, '', 0);
                    }
                    pagecontent.appendChild(li);
                }
                prev.onclick=function(){
                    postGiftFeeData(self, self.giftfee_type.value, pageindex, pagesize, 1, '', 0);
                };
                next.onclick=function(){
                    // 分页的时候判断是不是选中状态
                    postGiftFeeData(self, self.giftfee_type.value, pageindex, pagesize, 1, '', 0);
                };
                if (pageindex > 1) {
                    prev.onclick = function(){
                        pageindex--;
                        createPage();
                        postGiftFeeData(self, self.giftfee_type.value, pageindex, pagesize, 1, '', 0);
                    };
                }
                if (pageindex < pageCount) {
                        next.onclick = function(){
                        pageindex++;
                        createPage();
                        postGiftFeeData(self, self.giftfee_type.value, pageindex, pagesize, 1, '', 0);
                    };
                }
                //记录选中的状态 
                getChenckedClick();
                getChecked();
            }
            function getChenckedClick(){
                //给每个复选框循环添加点击事件
                // let obj = document.getElementsByName('checkbox');
                let obj = document.getElementsByClassName('checkbox');
                console.log(obj, 'obj');
                for(let i = 0;i < obj.length; i++){
                    // let btn = document.getElementById('chenckedId' + i);
                    obj[i].onclick = function(e){
                        console.log(e);
                        if(e.target.parentElement.parentElement.classList.length === 0){
                            e.target.parentElement.parentElement.classList = ['checked'];
                            e.target.parentElement.parentElement.style = "background: #4169E1";
                            checkedIds += e.target.innerText + ',';
                        } else {
                            e.target.parentElement.parentElement.classList = [];
                            e.target.parentElement.parentElement.style = "background: white";
                            checkedIds = checkedIds.replace((e.target.innerText + ','), '');
                        }
                        // console.log(e.target, e.target.parentElement.parentElement);
                        console.log(checkedIds, 'checkedIds');
                    }
                }
            }
            //分页的时候判断是不是属于选中状态
            function getChecked(){
                if(checkedIds == ""){
                    return;
                }
                let oneches = document.getElementsByName("checkbox");
                for(let i = 0;i < oneches.length;i++){
                    //全局变量中含有id，则该复选框选中
                    if(contains(checkedIds, oneches[i].value)){
                        oneches[i].checked = "checked";
                    }
                }
                console.log(checkedIds, "checkedIds");
            }
            //判断是否存在选中的数据
            function contains(obj, ele) {
                if(obj == ""){
                    return;
                }
                /*若参数obj为字符串时，需要转换成数组*/
                var arr = obj.split(",");
                var i = arr.length;
                while (i--) {
                    if (arr[i] == ele) {
                        return true;  
                    }  
                }  
                return false;  
            }
            // 弹框中查询按钮点击事件
            function searchClickGift(self){
                let searchBoxDom = document.getElementById('searchBoxGift');
                let searchBtn = searchBoxDom.querySelector('button');
                let searchInput = searchBoxDom.querySelectorAll('input')[0];
                let searchInput2 = searchBoxDom.querySelectorAll('input')[1];
                console.log(searchInput, searchInput2, '6688');
                searchBtn.onclick = function(){
                    let loading = self.$message.loading('查询中...', 0);
                    if(searchInput.value == '' && searchInput2.value == ''){
                        postGiftFeeData(self, self.giftfee_type.value, pageindex, pagesize, 1, '', 0);
                    }else if(searchInput.value != '' && searchInput2.value == ''){
                        postGiftFeeData(self, self.giftfee_type.value, pageindex, pagesize, 1, searchInput.value, 2);
                    }else if(searchInput.value == '' && searchInput2.value != ''){
                        postGiftFeeData(self, self.giftfee_type.value, pageindex, pagesize, 1, searchInput2.value, 3);
                    }else{
                        self.$message.error('不能同时进行两个条件查询');
                        searchInput.value = '';
                        searchInput2.value = '';
                    }
                    loading();
                }
            }
            searchClickGift(self);
        }
        // 匹配赠送费用类型
        function regGiftType(giftType){
            if(/\s/.test(giftType)){
                giftType = giftType.replace(/\s+/g,"");
            }
            let giftTypeCode = '';
            switch(giftType){
                case '销售运费':
                    giftTypeCode = 'sale_freight_balance';
                break;
                case '油卡费用':
                    giftTypeCode = 'oil_balance';
                break;
                case '其他费用':
                    giftTypeCode = 'other_fee_balance';
                break;
                case '配件费用':
                    giftTypeCode = 'parts_balance';
                break;
                case '中介费用':
                    giftTypeCode = 'agency_money_balance';
                break;
            }
            return giftTypeCode;
        }
        // 绘制费用说明点击弹框内容
        function dataChange1(self, code){
            // table主体
            const datalist = tablelist.map((item,index) => {
                if(index < 15){
                    return '<tr>'+
                            '<th>'+'<input type="radio" name="radio" id="checkedId' + index +'" value="' + item.TXT50 + '#' + item.SAKNR +'" />'+'</th>'+
                            '<th>'+ item.TXT50 +'</th>'+
                            '<th>'+ item.SAKNR +'</th>'+
                            '</tr>'
                }
            }).join('');
            // table的表头
            const bulletBox = 
            `<table id="tb" class="bulletBox" border="1" frame=box>
                <thead>
                    <tr>
                        <th>序号</th>
                        <th>费用说明</th>
                        <th>科目代码</th>
                    </tr>
                </thead>
                <tbody>
                    ${datalist}
                </tbody>
            </table>`;
            const querySearch =
            `<div id="searchBox">
                <input type="text" value="${code ? code : ''}" class="searchInput" placeholder="请输入费用说明或科目代码" />
                <button class="searchBtn" type="button">查 询</button>
            </div>`;
            function getMobileContent(){
                var isMtableBox = window.document.getElementsByClassName('h3-modal-alert-content')[0];
                if(isMtableBox){
                    window.clearTimeout(t1);
                    isMtableBox.innerHTML = querySearch + bulletBox;
                }else{
                    var t1 = setTimeout(getMobileContent, 100);
                }
            }
            if(isMobile){
                getMobileContent();
            }else{
                var tableBox = window.document.getElementsByClassName('tableBox')[0];
                tableBox.innerHTML = querySearch + bulletBox;
            }
            // 弹框中查询按钮点击事件
            function searchClick(){
                let searchBoxDom = document.getElementById('searchBox');
                let searchBtn = searchBoxDom.querySelector('button');
                let searchInput = searchBoxDom.querySelector('input');
                searchBtn.onclick = function(){
                    if(searchInput.value == ''){
                        getSapData(self);
                    }else{
                        getSapData(self, searchInput.value);
                    }
                }
            }
            searchClick();
            function radioCheck(){
                let ss = document.getElementsByName('radio');
                for(let i = 0;i < ss.length;i++){
                    let radioBtn = document.getElementById('checkedId' + i);
                    radioBtn.onclick = function(){
                        checkedValue = ss[i].value.split('#')[0];
                        checkedCode = ss[i].value.split('#')[1];
                        $(radioBtn).attr("checked", true);
                        if(isMobile){
                            $(ss[i]).parent().parent().css("background", "#4169E1");
                            $(ss[i]).parent().parent().siblings().css("background", "white");
                        }
                    }
                    $(ss[i]).parent().parent().on('click', function(){
                        checkedValue = ss[i].value.split('#')[0];
                        checkedCode = ss[i].value.split('#')[1];
                        $(ss[i]).prop("checked", true);
                        if(isMobile){
                            $(ss[i]).parent().parent().css("background", "#4169E1");
                            $(ss[i]).parent().parent().siblings().css("background", "white");
                        }
                    })
                }
            }
            radioCheck();
        }
        // 绘制成本中心说明点击弹框内容
        function dataChange2(self, type, code){
            // table主体
            const datalist2 = tablelist2.map((item,index)=>{
                if(index < 15){
                    return '<tr>'+
                            '<th>'+'<input type="radio" name="radio" id="checkedId2' + index +'" value="' + item.LTEXT + '#' + item.KOSTL + '#' + item.PRCTR + '#' + item.MCTXT +'" />'+'</th>'+
                            '<th>'+ item.LTEXT +'</th>'+
                            '</tr>'
                }
            }).join('');
            // table的表头
            const bulletBox2 =
            `<table id="tb" class="bulletBox2" border="1" frame=box>
                <thead>
                    <tr>
                        <th>序号</th>
                        <th>成本中心</th>
                    </tr>
                </thead>
                <tbody>
                    ${datalist2}
                </tbody>
            </table>`;
            const querySearch2 =
            `<div id="searchBox2">
                <input type="text" value="${type && code ? code : ''}" class="searchInput2" placeholder="通过成本中心查询" />
                <button class="searchBtn2" id="searchBtn2" type="button">查 询</button>
            </div>`;
            function getMobileContent2(){
                var isMtableBox2 = window.document.getElementsByClassName('h3-modal-alert-content')[0];
                if(isMtableBox2){
                    window.clearTimeout(t2);
                    isMtableBox2.innerHTML = querySearch2 + bulletBox2;
                }else{
                    var t2 = setTimeout(getMobileContent2, 100);
                }
            }
            if(isMobile){
                getMobileContent2();
            }else{
                var tableBox2 = window.document.getElementsByClassName('tableBox2')[0];
                tableBox2.innerHTML = querySearch2 + bulletBox2;
            }
            // 弹框中查询按钮点击事件
            function searchClick2(self){
                let searchBoxDom2 = document.getElementById('searchBox2');
                console.log(searchBoxDom2, 'searchBoxDom2');
                let searchBtn2 = searchBoxDom2 ? searchBoxDom2.querySelector('.searchBtn2') : '';
                let searchInput2 = searchBoxDom2 ? searchBoxDom2.querySelectorAll('input')[0] : '';
                if(searchBtn2){
                    searchBtn2.onclick = function(){
                        if(searchInput2 && searchInput2.value != ''){
                            getSapData2(self, true, searchInput2.value);
                        }
                    }
                }
            }
            searchClick2(self);
            function radioCheck2(){
                let dd = document.getElementsByName('radio');
                for(let i = 0;i < dd.length;i++){
                    let radioBtn2 = document.getElementById('checkedId2' + i);
                    radioBtn2.onclick = function(){
                        checkedValue2 = dd[i].value.split('#')[0];
                        checkedCode2 = dd[i].value.split('#')[1];
                        checkedCode3 = dd[i].value.split('#')[2];
                        checkedCode4 = dd[i].value.split('#')[3];
                        $(radioBtn2).attr("checked", true);
                        // console.log(checkedValue2, checkedCode2, checkedCode3, checkedCode4, 'lklk', $(dd[i]).parent());
                        if(isMobile){
                            $(dd[i]).parent().parent().css("background", "#4169E1");
                            $(dd[i]).parent().parent().siblings().css("background", "white");
                        }
                    }
                    $(dd[i]).parent().parent().on('click', function(){
                        checkedValue2 = dd[i].value.split('#')[0];
                        checkedCode2 = dd[i].value.split('#')[1];
                        checkedCode3 = dd[i].value.split('#')[2];
                        checkedCode4 = dd[i].value.split('#')[3];
                        $(dd[i]).prop("checked", true);
                        if(isMobile){
                            $(dd[i]).parent().parent().css("background", "#4169E1");
                            $(dd[i]).parent().parent().siblings().css("background", "white");
                        }
                    })
                }
            }
            radioCheck2();
        }
        // 绘制对方单位名称点击弹框内容
        function dataChange3(self, code){
            // table主体
            const datalist3 = tablelist3.map((item,index)=>{
                if(index < 15){
                    return '<tr>'+
                            '<th>'+'<input type="radio" name="radio" id="checkedId3' + index +'" value="' + item.NAME + '#' + item.CID +'" />'+'</th>'+
                            '<th>'+ item.NAME +'</th>'+
                            '<th>'+ item.CID +'</th>'+
                            '</tr>'
                }
            }).join('');
            // table的表头
            const bulletBox3 =
            `<table id="tb" class="bulletBox3" border="1" frame=box>
                <thead>
                    <tr>
                        <th>序号</th>
                        <th>对方单位名称</th>
                        <th>编号</th>
                    </tr>
                </thead>
                <tbody>
                    ${datalist3}
                </tbody>
            </table>`;
            const querySearch3 =
            `<div id="searchBox3">
                <input type="text" value="${code ? code : ''}" class="searchInput4" placeholder="请输入对方单位名称或编号" />
                <button class="searchBtn3" type="button">查 询</button>
            </div>`;
            function getMobileContent3(){
                var isMtableBox3 = window.document.getElementsByClassName('h3-modal-alert-content')[0];
                if(isMtableBox3){
                    window.clearTimeout(t3);
                    isMtableBox3.innerHTML = querySearch3 + bulletBox3;
                }else{
                    var t3 = setTimeout(getMobileContent3, 100);
                }
            }
            if(isMobile){
                getMobileContent3();
            }else{
                var tableBox3 = window.document.getElementsByClassName('tableBox3')[0];
                tableBox3.innerHTML = querySearch3 + bulletBox3;
            }
            // 对方单位名称弹框中查询按钮点击事件
            function searchClick3(self){
                let searchBoxDom3 = document.getElementById('searchBox3');
                let searchBtn3 = searchBoxDom3 ? searchBoxDom3.querySelector('button') : '';
                let searchInput4 = searchBoxDom3 ? searchBoxDom3.querySelector('input') : '';
                let searchPatten = self.query_type.value;
                if(searchBtn3){
                    searchBtn3.onclick = function(){
                        if(searchInput4.value == ''){
                            getSapData3(self, searchPatten);
                        }else{
                            getSapData3(self, searchPatten, searchInput4.value);
                        }
                    }
                }
            }
            searchClick3(self);
            function radioCheck3(){
                let mm = document.getElementsByName('radio');
                for(let i = 0;i < mm.length;i++){
                    let radioBtn3 = document.getElementById('checkedId3' + i);
                    radioBtn3.onclick = function(){
                        checkedValue3 = mm[i].value.split('#')[0];
                        checkedCode5 = mm[i].value.split('#')[1];
                        $(radioBtn3).attr("checked", true);
                        if(isMobile){
                            $(mm[i]).parent().parent().css("background", "#4169E1");
                            $(mm[i]).parent().parent().siblings().css("background", "white");
                        }
                    }
                    $(mm[i]).parent().parent().on('click', function(){
                        checkedValue3 = mm[i].value.split('#')[0];
                        checkedCode5 = mm[i].value.split('#')[1];
                        $(mm[i]).prop("checked", true);
                        if(isMobile){
                            $(mm[i]).parent().parent().css("background", "#4169E1");
                            $(mm[i]).parent().parent().siblings().css("background", "white");
                        }
                    })
                }
            }
            radioCheck3();
        }
        // 获取DOM节点为各触发弹框添加点击事件方法
        // clickNode: 需要加点击弹框的子表key
        // clickIndex: 需要加点击弹框的子表字段序号
        // type: 传参匹配类型
        // witch: 需要使用第几种弹窗
        function getModelClick(self, clickNode, clickIndex, type, witch){
            if(isMobile){
                let sheetDom = document.getElementById(clickNode);
                let panelBody = sheetDom ? sheetDom.querySelector('.horizontal') : '';
                let sheetAll = panelBody ? panelBody.childNodes : '';
                for(let i = 0;i < sheetAll.length;i++){
                    sheetAll[i].childNodes[1].childNodes[clickIndex].onclick = function(){
                        switch(witch){
                            case 0:
                            getModalbox(self, i, type);
                            break;
                            case 1:
                            getModalbox2(self, i ,type);
                            break;
                        }
                    }
                }
            }else{
                let bb = $('.fullsheet', document);
                if(bb && bb.length > 0){
                    let cc = $('.sheet', bb);
                    let dd = $('.sheet__body', cc);
                    let ee = $('.sheet__row', dd);
                    let ff = $('.sheet__cols', ee);
                    let gg = $('.sheet__row', ff);
                    console.log(gg, 'gg');
                    for(let i = 0;i < gg.length;i++){
                        gg[i].childNodes[clickIndex].onclick = function(){
                            switch(witch){
                                case 0:
                                getModalbox(self, i, type);
                                break;
                                case 1:
                                getModalbox2(self, i ,type);
                                break;
                            }
                        }
                    }
                }
                let sheetDom = document.getElementById(clickNode);
                let panelBody = sheetDom ? sheetDom.querySelector('.h3-panel-body') : '';
                let wrapDom = panelBody ? panelBody.querySelector('.warp') : '';
                let sheetWrap = wrapDom ? wrapDom.querySelector('.sheet') : '';
                let sheetBody = sheetWrap ? sheetWrap.querySelector('.sheet__body') : '';
                let sheetNode = sheetBody ? sheetBody.childNodes : '';
                for(let i = 0;i < sheetNode.length;i++){
                    sheetNode[i].querySelector('.sheet__cols').querySelector('.sheet__row').childNodes[clickIndex].onclick = function(){
                        switch(witch){
                            case 0:
                            getModalbox(self, i, type);
                            break;
                            case 1:
                            getModalbox2(self, i ,type);
                            break;
                        }
                    }
                }
            }
        }
        // 获取DOM节点为对方单位名称字段company_name添加点击事件方法
        function getModelClickSpec(self){
            let sheetDom3 = document.getElementById('company_name');
            sheetDom3.onclick = function(){
                let searchPatten = self.query_type.value;
                if(searchPatten && searchPatten !== '' && searchPatten != null){
                    getModalbox3(self, searchPatten);
                }else{
                    self.$message.error('请先勾选查询类型');
                }
            }
        }
        // 获取DOM节点为成本中心字段cost_select添加点击事件方法
        function getModelClickCost(self){
            let sheetDomCost = document.getElementById('cost_select');
            sheetDomCost.onclick = function(){
                getModalbox2(self, 0 ,2);
            }
        }
        // 绘制费用说明弹出框页面
        function getModalbox(self, i, type){
            getSapData(self);
            if(isMobile){
                self.$confirm({
                    title: "费用说明选择",
                    onOk:function(){
                        //点击确定的时候将拿到页面选中的id请求接口
                        if(checkedValue){
                            if(type === 1){
                                self.general_ledger_vouche.rows[i].value = {
                                    expenses_introduce: checkedValue,
                                    ledger_account: checkedCode
                                }
                            }else{
                                self.reimbursement_erp.rows[i].value = {
                                    expenses_introduce: checkedValue,
                                    ledger_account: checkedCode
                                };
                            }
                        }
                    },
                    onCancel:function(){
                        console.log('1,cancel', i);
                    },
                })
            }else{
                self.$confirm({
                    title: "费用说明选择",
                    content: {
                        tag: 'div',
                        data: {
                            id: 'tableBox',
                            class: 'tableBox'
                        },
                    },
                    onOk:function(){
                        //点击确定的时候将拿到页面选中的id请求接口
                        if(checkedValue){
                            if(type === 1){
                                self.general_ledger_vouche.rows[i].value = {
                                    expenses_introduce: checkedValue,
                                    ledger_account: checkedCode
                                }
                            }else{
                                self.reimbursement_erp.rows[i].value = {
                                    expenses_introduce: checkedValue,
                                    ledger_account: checkedCode
                                };
                            }
                        }
                    },
                    onCancel:function(){
                        console.log('2,cancel', i);
                    },
                })
            }
            dataChange1(self);
        }
        // 绘制成本中心-说明弹出框页面
        function getModalbox2(self, i, type){
            getSapData2(self, true);
            if(isMobile){
                self.$confirm({
                    title: "成本中心选择",
                    onOk:function(){
                        //点击确定的时候将拿到页面选中的id请求接口
                        if(type === 1){
                            if(checkedValue2){
                                self.general_ledger_vouche.rows[i].value = {
                                    cost_center_introduce: checkedValue2,
                                    cost_center: checkedCode2,
                                    profit_center: checkedCode3
                                };
                            }
                        }else if(type === 0){
                            if(checkedValue2){
                                self.reimbursement_erp.rows[i].value = {
                                    cost_center_introduce: checkedValue2,
                                    cost_center: checkedCode2,
                                    profit_center: checkedCode3
                                };
                            }
                        }else{
                            if(checkedValue2){
                                console.log(checkedValue2, 'checkedValue2');
                                self.cost_select.value = checkedCode2;
                                // 成本中心cost_select存储costSelect
                                costSelect.cost_center_introduce = checkedValue2;
                                costSelect.cost_center = checkedCode2;
                                costSelect.profit_center = checkedCode3;
                                costSelect.profit_center_introduce = checkedCode4;
                                console.log(costSelect, 'costSelect');
                            }
                        }
                    },
                    onCancel:function(){
                        console.log('1,cancel', i);
                    },
                })
            }else{
                self.$confirm({
                    title: "成本中心选择",
                    content: {
                        tag: 'div',
                        data: {
                            id: 'tableBox2',
                            class: 'tableBox2'
                        },
                    },
                    onOk:function(){
                        if(type === 1){
                            if(checkedValue2){
                                self.general_ledger_vouche.rows[i].value = {
                                    cost_center_introduce: checkedValue2,
                                    cost_center: checkedCode2,
                                    profit_center: checkedCode3
                                };
                            }
                        }else if(type === 0){
                            if(checkedValue2){
                                self.reimbursement_erp.rows[i].value = {
                                    cost_center_introduce: checkedValue2,
                                    cost_center: checkedCode2,
                                    profit_center: checkedCode3
                                };
                            }
                        }else{
                            if(checkedValue2){
                                console.log(checkedValue2, 'checkedValue2');
                                self.cost_select.value = checkedCode2;
                                // 成本中心cost_select存储costSelect
                                costSelect.cost_center_introduce = checkedValue2;
                                costSelect.cost_center = checkedCode2;
                                costSelect.profit_center = checkedCode3;
                                costSelect.profit_center_introduce = checkedCode4;
                                console.log(costSelect, 'costSelect');
                            }
                        }
                    },
                    onCancel:function(){
                        console.log('2,cancel', i);
                    },
                })
            }
            dataChange2(self, true);
        }
        // 绘制对方单位信息字段company_name弹出框页面
        function getModalbox3(self, searchPatten){
            getSapData3(self, searchPatten);
            if(isMobile){
                self.$confirm({
                    title: "对方单位名称选择",
                    onOk:function(){
                        // 点击确认的时候将选中值赋值到对方单位名称字段company_name
                        if(checkedValue3){
                            self.company_name.value = checkedValue3;
                            self.serial_number.value = checkedCode5;
                        }
                    },
                    onCancel:function(){
                        console.log('3,cancel');
                    }
                })
            }else{
                self.$confirm({
                    title: "对方单位名称选择",
                    content: {
                        tag: 'div',
                        data: {
                            id: 'tableBox3',
                            class: 'tableBox3'
                        },
                    },
                    onOk:function(){
                        // 点击确认的时候将选中值赋值到对方单位名称字段company_name
                        if(checkedValue3){
                            self.company_name.value = checkedValue3;
                            self.serial_number.value = checkedCode5;
                        }
                    },
                    onCancel:function(){
                        console.log('3,cancel');
                    }
                })
            }
            dataChange3(self);
        }
        // 绘制赠送报销弹出框
        function getModalboxGift(self, giftType){
            if(isMobile){
                self.$confirm({
                    title: '赠送报销类型选择',
                    onOk: function(){
                        if(checkedIds !== ''){
                            getAllCheckedToList(self, giftType);
                        }else{
                            // self.$message.warning('请先勾选需要获取的订单');
                        }
                    },
                    onCancel: function(){
                        console.log('1,cancel');
                    }
                });
            }else{
                self.$confirm({
                    title: '赠送报销类型选择',
                    content: {
                        tag: 'div',
                        data: {
                            id: 'tableBox',
                            class: 'tableBox'
                        }
                    },
                    onOk: function(){
                        if(checkedIds !== ''){
                            getAllCheckedToList(self, giftType);
                        }else{
                            // self.$message.warning('请先勾选需要获取的订单');
                        }
                    },
                    onCancel: function(){
                        console.log('1,cancel');
                        checkedIds = '';
                    }
                });
            }
            setTimeout(() => {
                dataChangeGift(self, giftType);
            }, 500)
        }
        // 赠送报销点击确定后将选中的数据赋值到明细子表
        async function getAllCheckedToList(self, giftType){
            const newcheckVal = checkedIds.split(',').slice(0,checkVal.length - 1);
            await postGiftFeeData(self, giftType, 1, newcheckVal.length, 2, newcheckVal, 1).then(()=>{
                let loading = self.$message.loading('数据加载中...', 0);
                const tableList = tablelistGift;
                console.log(tableList, 'aaassss', tableGiftType, newcheckVal);
                self.reimbursement_detail.value = [];
                let giftTypeCode = regGiftType(giftType);
                console.log(giftTypeCode, 'giftTypeCode');
                let arr = new Array(tablelistGift.length);
                let resSum = 0;
                for(let i = 0;i < tablelistGift.length;i++){
                    self.reimbursement_detail.insertRow(i, {});
                    arr[i] = {
                        expenses_first: tableGiftType.class_a_title,
                        expenses_second: tableGiftType.class_b_title,
                        expenses_third: tableGiftType.class_c_title,
                        class_code: tableGiftType.class_c_code,
                        product_id: tablelistGift[i].id,
                        contract_no: tablelistGift[i].contract_no,
                        brand: tablelistGift[i].main_product_brand,
                        model: tablelistGift[i].main_product_model,
                        category: tablelistGift[i].main_product_classify,
                        salesman_name: tablelistGift[i].retain_user_name,
                        customer_name: tablelistGift[i].customer_name,
                        product_number: tablelistGift[i].main_product_number,
                        deal_date: tablelistGift[i].deal_date,
                        expenses_amount: tablelistGift[i][giftTypeCode],
                        product_id: String(tablelistGift[i].id),
                        review_amount: tablelistGift[i][giftTypeCode],
                        erp_code: tableGiftType.erp_code
                    }
                    resSum += tablelistGift[i][giftTypeCode];
                }
                self.reimbursement_detail.value = arr;
                self.reimbursement_detail.getRowValueChange(tablelistGift.length - 1).subscribe((change) => {
                    loading();
                });
                // 接口调用完之后调用克克接口获取招待费报销的金额
                console.log(tablelistGift, 'tablelistGift', tableGiftType);
                let regParam = [];
                regParam.push({
                    firstName: tableGiftType.class_a_title,
                    secondName: tableGiftType.class_b_title,
                    thirdName: tableGiftType.class_c_title,
                    row: '0'
                });
                regId(self, regParam, resSum, tableGiftType);
            });
        }
        // 日期格式化方法:将日期时间戳格式转化为YYYY-MM-DD格式
        function dateFormat(date){
            var y = new Date(date).getFullYear();
            var m = new Date(date).getMonth() + 1;
            m = m < 10 ? '0' + m : m;
            var d = new Date(date).getDate();
            d = d < 10 ? ('0' + d) : d;
            return y + '-' + m + '-' + d;
        }
        // 根据小写金额转为大写金额填充到字段
        // 实际支付金额：actual_amount  大写金额：amount_capitalize
        function digitUppercase(n){ // 小写金额转大写金额方法
            let fraction = ['角', '分'];
            let digit = ['零', '壹', '贰', '叁', '肆','伍', '陆', '柒', '捌', '玖'];
            let unit = [['元', '万', '亿'],['', '拾', '佰', '仟']];
            let head = n < 0 ? '欠' : '';
            n = Math.abs(n);
            let s = '';
            for (let i = 0; i < fraction.length; i++) {
                s += (digit[Math.floor(Math.floor(n * 1000 * 10 * Math.pow(10, i)) % (10 * 1000) / 1000)] + fraction[i]).replace(/零./, '');
            }
            s = s || '整';
            n = Math.floor(n);
            for (let i = 0; i < unit[0].length && n > 0; i++) {
                let p = '';
                for (let j = 0; j < unit[1].length && n > 0; j++) {
                    p = digit[n % 10] + unit[1][j] + p;
                    n = Math.floor(n / 10);
                }
                s = p.replace(/(零.)*零$/, '').replace(/^$/, '零') + unit[0][i] + s;
            }
            return head + s.replace(/(零.)*零元/, '元').replace(/(零.)+/g, '零').replace(/^整$/, '零元整');
        }
        // 通过智慧松宇接口返回的一二三级费用名称拼接成后端需要的接口参数
        function regClassTitle(returnData){
            let result = [];
            for(let i = 0;i < returnData.length;i++){
                result.push({
                    firstName: returnData[i].class_a_title,
                    secondName: returnData[i].class_b_title,
                    thirdName: returnData[i].class_c_title,
                    row: i
                });
            }
            return result;
        }
        // 招待费用报销类型下，通过参数公司代码：员工工号：申请年份：申请月份调用智慧松宇接口进行招待费合计、明细子表操作
        function entertainFunction(self, dataId){
            self.apply_yearmonth.valueChange.subscribe((change)=>{
                if(change.value && change.value !== null || change.value !== ''){
                    let year = new Date(change.value).getFullYear();
                    let month = new Date(change.value).getMonth() + 1;
                    let companyCode = self.company_code.value;
                    let jobCode = self.job_code.value;
                    if(!companyCode){
                        self.$message.error('未获取到公司代码，请检查部门和所在公司');
                    }else if(!jobCode){
                        self.$message.error('未获取到员工工号');
                    }else{
                        getFeeCharged(self, dataId, companyCode, jobCode, year, month);
                    }
                }
            });
        }
        // 调智慧松宇销售台量招待费费控接口
        function getFeeCharged(self, dataId, companyCode, jobCode, year, month){
            let out_token = 'JWT eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1OTY0NDI3NTQsImlzcyI6InNvbnl1IiwiZGF0YSI6eyJ1aWQiOiJkaW5ndGFsayJ9fQ.wdcdnNxU_QQNM6jTayo_5CYuuk5ifUhD4QTUTsqK7B0';
            window.localStorage.setItem('out_token', out_token);
            axios({
                method: 'get',
                url: `http://sycrm.sonyu.cn:8899/api/ZHSY_GET_CONTRACT_TO_DINGTALK/ssss/${companyCode}/${jobCode}/${year}/${month}`,
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'Authorization': 'JWT eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1NTY0MzE1OTMsImlzcyI6InNvbnl1IiwiZGF0YSI6eyJ1aWQiOiJTWTAwMDc4NyJ9fQ.GMcYJgG8I1ZuU84fwnL8rGJ-fly2FFjMkb9zjoX1ZL0'
                },
            }).then(res=>{
                console.log(res, '费控接口返回');
                let loading = self.$message.loading('数据加载中...', 0);
                if(res && res.DETAL.length){
                    let returnDetal = res.DETAL;
                    let returnSUBJECT = res.SUBJECT;
                    // 费用报销明细: 根据初始子表行数自动新增行数到接口返回行数
                    if(self.reimbursement_detail.value.length <= returnDetal.length){
                        let arr = new Array(returnDetal.length);
                        // 将接口返回值填充到费用报销明细子表的各字段中
                        for(let j = 0;j < returnDetal.length; j++){
                            arr[j] = {
                                expenses_first: returnSUBJECT.class_a_title,
                                expenses_second: returnSUBJECT.class_b_title,
                                expenses_third: returnSUBJECT.class_c_title,
                                contract_no: returnDetal[j].contract_no,
                                salesman_name: returnDetal[j].name,
                                customer_name: returnDetal[j].customer_name,
                                model: returnDetal[j].main_product_model,
                                category: returnDetal[j].main_product_classify,
                                brand: returnDetal[j].main_product_brand,
                                product_id: String(returnDetal[j].id),
                                product_number: returnDetal[j].main_product_number,
                                deal_date: returnDetal[j].deal_date,
                                erp_code: returnSUBJECT.erp_code,
                                class_code: returnSUBJECT.class_c_code ? String(returnSUBJECT.class_c_code) : ''
                            }
                        }
                        self.reimbursement_detail.value = arr;
                        self.reimbursement_detail.getRowValueChange(returnDetal.length - 1).subscribe((change) => {
                            loading();
                        });
                    }
                    // 接口调用完之后调用克克接口获取招待费报销的金额
                    getFeeMoney(self, dataId, returnSUBJECT);
                }else{
                    loading();
                    self.$message.error('未获取到当前月份的数据');
                    self.reimbursement_detail.value = [];
                    self.reimbursement_detail_total.value = [];
                }
                window.localStorage.removeItem('out_token');
            }).catch(e=>{
                loading();
                window.localStorage.removeItem('out_token');
            });
        }
        // 费控--调用克克接口获取招待费报销各明细子表对应金额
        function getFeeMoney(self, dataId, returnSUBJECT){
            let company = self.company.value; // 所在公司
            let position = self.position.value; // 岗位
            let dataList = self.reimbursement_detail.value; // 明细子表数据
            let parentId = dataId; // 主表id
            if(!company || !company.length){
                self.$message.error('未获取到所在公司');
            }else if(!position){
                self.$message.error('未获取到岗位');
            }else if(!dataList || !dataList.length){
                self.$message.error('未获取到费用报销明细数据');
            }else{
                let companyId = company ? company[0].id : '';
                let companyType = company ? company[0].unitType : '';
                let paramArr = [];
                dataList.forEach((item, index)=>{
                    paramArr.push({
                        area: item.area,
                        brand: item.brand,
                        category: item.category,
                        classCode: item.class_code,
                        contractNo: item.contract_no,
                        dealDate: null,
                        expensesAmount: item.expenses_amount,
                        expensesDescribe: item.expenses_describe,
                        expensesFirst: item.expenses_first,
                        expensesSecond: item.expenses_second,
                        expensesThird: item.expenses_third,
                        id: item.id,
                        invoiceCount: item.invoice_count,
                        isAdopt: item.is_adopt,
                        model: item.model,
                        parentid: parentId,
                        productId: item.product_id,
                        productNumber: item.product_number,
                        reason: item.reason,
                        reviewAmount: item.review_amount,
                        salesmanName: item.salesman_name,
                        sortkey: index
                    });
                });
                let paramData = {
                    company: JSON.stringify([{
                        id: companyId,
                        type: companyType
                    }]),
                    list: paramArr,
                    position: position
                };
                let loading = this.$message.loading('数据加载中...', 0);
                axios.post('http://113.12.64.58:88/api/ext/v1/expenses/getMoney', paramData).then(res=>{
                    if(res && res.errcode === 0){
                        let resDetail = res.data.detailList;
                        console.log(resDetail, 'resDetail');
                        let resSum = res.data.sum;
                        for(let j = 0;j < resDetail.length; j++){
                            self.reimbursement_detail.rows[j].value = {
                                expenses_amount: resDetail[j].expensesAmount
                            }
                        }
                        let regParam = [];
                        regParam.push({
                            firstName: returnSUBJECT.class_a_title,
                            secondName: returnSUBJECT.class_b_title,
                            thirdName: returnSUBJECT.class_c_title,
                            row: '0'
                        })
                        regId(self, regParam, resSum, returnSUBJECT);
                        loading();
                    }
                }).catch(e=>{
                    loading();
                    self.$message.error(e);
                });
            }
        }
        // 调用克克接口根据一二三级费用匹配id
        function regId(self, regParam, resSum, returnSUBJECT){
            let paramReg = {};
            paramReg.levels = regParam;
            axios.post('http://113.12.64.58:88/api/ext/v1/expenses/getIdAndErp_code', paramReg).then((res)=>{
                if(res && res.data.length){
                    let resDatas = res.data;
                    if(self.reimbursement_detail_total.value.length === 0){
                        self.reimbursement_detail_total.insertRow(0, {});
                    }
                    self.reimbursement_detail_total.rows[0].value = {
                        expenses_first: {
                            id: resDatas[0].firstId,
                            expenses_name: resDatas[0].firstName,
                        },
                        expenses_second: {
                            id: resDatas[0].secondId,
                            expenses_name: resDatas[0].secondName,
                        },
                        expenses_third: {
                            id: resDatas[0].thirdId,
                            expenses_name: resDatas[0].thirdName,
                        },
                        review_amount: resSum,
                        expenses_amount: resSum,
                        erp_code: returnSUBJECT.erp_code,
                        class_code: returnSUBJECT.class_c_code ? String(returnSUBJECT.class_c_code) : ''
                    }
                    self.erp_code.value = returnSUBJECT.erp_code;
                }
                self.apply_amount.value = resSum;
            }).catch(e=>{
                self.$message.error(e);
            })
        }
        // 赠送报销-费控接口返回
        function postGiftFeeData(self, giftType, pageindex, pagesize, type, paramData, paramType){
            let companyCode = self.company_code.value;
            let year = new Date(self.apply_yearmonth.value).getFullYear();
            let month = new Date(self.apply_yearmonth.value).getMonth() + 1;
            if(month < 10){
                month = '0' + month;
            }else{
                month = String(month);
            }
            if(!companyCode){
                self.$message.error('未获取到公司代码，请检查部门和所在公司');
            }
            let out_token = 'JWT eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1OTY0NDI3NTQsImlzcyI6InNvbnl1IiwiZGF0YSI6eyJ1aWQiOiJkaW5ndGFsayJ9fQ.wdcdnNxU_QQNM6jTayo_5CYuuk5ifUhD4QTUTsqK7B0';
            window.localStorage.setItem('out_token', out_token);
            let giftTypeCode = regGiftType(giftType);
            return axios({
                method: 'post',
                url: `http://sycrm.sonyu.cn:8899/api/ZHSY_GET_BALANCE_TO_DINGTALK/ssss/gift/${giftTypeCode}/${companyCode}/${year}/${month}/${pageindex}/${pagesize}`,
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'Authorization': 'JWT eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1NTY0MzE1OTMsImlzcyI6InNvbnl1IiwiZGF0YSI6eyJ1aWQiOiJTWTAwMDc4NyJ9fQ.GMcYJgG8I1ZuU84fwnL8rGJ-fly2FFjMkb9zjoX1ZL0'
                },
                data: {
                    order: 'id;asc',
                    params: paramType === 1 ? ["id;in;"+paramData] : (paramType === 2 ? ["contract_no;eq;"+paramData] : (paramType === 3 ? [`Res_users.name;like;${paramData}`] : []))
                },
            }).then(res=>{
                console.log(res, '赠送报销接口返回');
                count = res.totalrows;
                tableGiftType = res[giftTypeCode];
                if(type === 0){
                    tablelistGift = res.querydata;
                    getModalboxGift(self, giftType);
                }else if(type === 1){
                    tablelistGift = res.querydata;
                    dataChangeGift(self, giftType);
                }else if(type === 2){
                    tablelistGift = res.querydata;
                }
                window.localStorage.removeItem('out_token');
            }).catch(e=>{
                self.$message.error(e);
                window.localStorage.removeItem('out_token');
            });
        }
        // 普通报销类型--在财务人员审批节点，自动将合计表值带到ERP子表中
        function detailToERP(self, costSelect, accountName){
            if((procStatus === 'PROCESSING' && self.workflowInfo.activityName === '财务中心会计') || accountName === 'admin'){
                let companyCode = self.company_code.value; // 公司代码
                let costCenterCode = self.cost_select.value; // 成本中心代码
                let detalAllData = self.reimbursement_detail_total.value; // 合计表所有数据
                self.serial_number.value = '';
                if(detalAllData && detalAllData.length > 0){
                    let regParam = [];
                    let resSum = [];
                    let resSums = 0;
                    let erpCodeArr = [];
                    console.log(detalAllData, 'detalAllData', 'WWWW');
                    for(let i = 0;i < detalAllData.length;i++){
                        regParam.push({
                            row: i,
                            firstName: detalAllData[i].expenses_first.expenses_name,
                            secondName: detalAllData[i].expenses_second.expenses_name,
                            thirdName: detalAllData[i].expenses_third.expenses_name
                        });
                        resSum.push(detalAllData[i].review_amount);
                        resSums += detalAllData[i].review_amount;
                    }
                    self.apply_amount.value = resSums;
                    let paramReg = {};
                    paramReg.levels = regParam;
                    axios({
                        method: 'post',
                        url: 'http://113.12.64.58:88/sap/bc/ZCL_FI_YS_CBZX?sap-client=800&sap-language=ZH',
                        headers: {
                            'sap-user': 'IF_USER',
                            'sap-password': 'sy123456',
                        },
                        data: {
                            'BUKRS': companyCode,
                            'KOSTL': costCenterCode
                        }
                    }).then(res => {
                        if(res && res.DETAILS.length){
                            costSelect.cost_center_introduce = res.DETAILS[0].LTEXT;
                            costSelect.cost_center = res.DETAILS[0].KOSTL;
                            costSelect.profit_center = res.DETAILS[0].PRCTR
                        }
                    }).then(() => {
                        axios.post('http://113.12.64.58:88/api/ext/v1/expenses/getIdAndErp_code', paramReg).then(res=>{
                            if(res && res.errcode === 0){
                                let returnData = res.data;
                                console.log(returnData, '返回数据');
                                for(let i = 0;i < returnData.length;i++){
                                    erpCodeArr.push(returnData[i].erpCode);
                                }
                                console.log(erpCodeArr, 'erpCodeArr');
                                self.reimbursement_erp.value = [];
                                for(let j = 0;j < erpCodeArr.length;j++){
                                    self.reimbursement_erp.insertRow(j,{});
                                    circlePostSap(self, j, erpCodeArr[j]);
                                    self.reimbursement_erp.rows[j].value = {
                                        amount: resSum[j],
                                        line_item: self.user_name.value[0].name + '-' + self.reimbursement_detail_total.value[j].expenses_second.expenses_name,
                                        job_code: self.job_code.value,
                                        cost_center_introduce: costSelect ? costSelect.cost_center_introduce : '',
                                        cost_center: costSelect ? costSelect.cost_center : '',
                                        profit_center: costSelect ? costSelect.profit_center : '',
                                        commit_project: self.reimbursement_detail_total.value[j].erp_code
                                    }
                                }
                                let lastIndex = self.reimbursement_detail_total.value.length;
                                self.reimbursement_erp.insertRow(lastIndex, {});
                                self.reimbursement_erp.rows[lastIndex].value = {
                                    pk: '31(贷方)',
                                    expenses_introduce: '其它应付款-员工',
                                    ledger_account: '2241040000',
                                    subject: self.job_code.value,
                                    amount: resSums,
                                    tax : ''
                                }
                                // 先置为0防止金额大写方法不触发
                                self.actual_amount.value = 0;
                                self.actual_amount.value = resSums;
                            }
                        }).catch(e=>{
                            self.$message.error(e);
                        });
                    }).catch(e=>{
                        self.$message.error(e);
                    });
                }
            }
        }
        /**
         * 事件绑定，form.on
         * @param eventType 事件类型
         * @params function 事件
         * @param  cover    true, false 是否覆盖root的生命周期 默认不覆盖 
         */
        //数据加载后，渲染之前，this为window
        form.on('onLoad',function(data, dataPermission){
            // 隐藏产品自带到打印按钮
            var btnPrint = this.actions.find(a => a.code === 'print');
            if(btnPrint){
                btnPrint.visible = false;
            }
            
            isMobile = window.location.href.includes("mobile");
            procStatus = data.sequenceStatus;
            // 页面加载前将提交功能换成暂存功能
            this.actions.forEach((item=>{
                if(item.code === 'submit'){
                    item.code = 'save';
                }
            }));
            // 加一个隐藏的提交按钮防止产品报错
            this.actions.push({
                code: 'submit',
                text: '提交',
                visible: false
            });
        },'cover');
        //渲染完成后
        form.on('onRendered',function(data){
            const self = this;
            setStyle();
            showApplyQuota(self, self.increase.value, self.judge_flag.value);
            applyQuota(data.id);
            modifyQuota(self);
            viewQuota(self.temporary.value);
            console.log(data, '全局data', this);
            // 普通报销三种类型情况下，合计子表第三级科目选完拼接科目代码到主表科目代码erp_code
            self.reimbursement_detail_total.getColumnValueChange('expenses_third').subscribe((change)=>{
                if(!procStatus || procStatus === 'DRAFT'){
                    if(self.reimbursement_type.value === '普通报销-非行政类' || self.reimbursement_type.value === '普通报销-行政类' || self.reimbursement_type.value === '普通报销-提成类'){
                        let endCode = '';
                        if(self.reimbursement_detail_total.value[0].expenses_first && self.reimbursement_detail_total.value[0].expenses_second){
                            let firstTit = self.reimbursement_detail_total.value[0].expenses_first.id;
                            let secondTit = self.reimbursement_detail_total.value[0].expenses_second.id;
                            let thirdTit = change.value[0] ? change.value[0].id : undefined;
                            if(firstTit && secondTit && thirdTit){
                                axios.post(`http://113.12.64.58:88/api/ext/v1/expenses/getErpCode?firstId=${firstTit}&secondId=${secondTit}&thirdId=${thirdTit}`).then((res)=>{
                                    if(res && res.errcode === 0){
                                        endCode = res.data
                                    }else{
                                        self.$message.error('未获取到erpCode');
                                    }
                                }).then(()=>{
                                    self.erp_code.value = endCode;
                                    self.reimbursement_detail_total.rows[0].value = {
                                        erp_code: endCode
                                    }
                                }).catch(e=>{
                                    console.log(e);
                                });
                            }else if(thirdTit !== undefined || secondTit !==undefined || firstTit !== undefined){
                                self.erp_code.value = '';
                                self.reimbursement_detail_total.rows[0].value = {
                                    erp_code: ''
                                }
                            }
                        }
                        console.log(change.value, 'asdf');
                        if(change.value[0] == null){
                            self.erp_code.value = '';
                            self.reimbursement_detail_total.rows[0].value = {
                                erp_code: ''
                            }
                        }
                    }
                }
            });
            // 监听合计子表一级费用变化时给二三级赋空
            self.reimbursement_detail_total.getColumnValueChange('expenses_first').subscribe((change)=>{
                if(self.reimbursement_type.value === '普通报销-非行政类' || self.reimbursement_type.value === '普通报销-行政类' || self.reimbursement_type.value === '普通报销-提成类'){
                    if(change.oldValue[0] && change.oldValue[0] !== undefined && change.value[0] !== change.oldValue[0]){
                        self.reimbursement_detail_total.getCell(0, 1).value = {};
                        self.reimbursement_detail_total.getCell(0, 2).value = {};
                    }
                    if(change.value[0] == null){
                        self.erp_code.value = '';
                        self.reimbursement_detail_total.rows[0].value = {
                            erp_code: ''
                        }
                    }
                }
            });
            // 监听合计子表二级费用变化时给三级赋空
            self.reimbursement_detail_total.getColumnValueChange('expenses_second').subscribe((change)=>{
                if(self.reimbursement_type.value === '普通报销-非行政类' || self.reimbursement_type.value === '普通报销-行政类' || self.reimbursement_type.value === '普通报销-提成类'){
                    if(change.oldValue[0] && change.oldValue[0] !== undefined && change.value[0] !== change.oldValue[0]){
                        self.reimbursement_detail_total.getCell(0, 2).value = {};
                    }
                    if(change.value[0] == null){
                        self.erp_code.value = '';
                        self.reimbursement_detail_total.rows[0].value = {
                            erp_code: ''
                        }
                    }
                }
            });
            this.actual_amount.valueChange.subscribe((change)=>{
                this.amount_capitalize.value = digitUppercase(change.value);
            });
            this.apply_amount.valueChange.subscribe((change)=>{
                this.amount_cap.value = digitUppercase(change.value);
            });
            // 页面加载后调用接口通过传经办人id将接口返回值赋值给收方银行:recipient_bank 和 收方银行账号:recipient_bank_code 和 对方单位名称:company_name
            if(!procStatus){ // 只页面加载获取，其他任何节点都不自动获取
                let loading = this.$message.loading();
                let timer = window.setInterval(() => {
                    console.log('111');
                    let userNameId = this.user_name.value ? this.user_name.value[0].id : ''; // userNameId: 经办人Id
                    if(userNameId !== ''){
                        axios.get('http://113.12.64.58:88/api/ext/v1/bankInfo/get_staff_bank?userId=' + userNameId).then((res)=>{
                            if(res && res.errcode === 0){
                                this.recipient_bank.value = res.data.bankName;
                                this.recipient_bank_code.value = res.data.bankAccount;
                                this.position.value = res.data.position;
                                this.company_name.value = res.data.jobCode;
                                this.serial_number.value = res.data.jobCode;
                                this.job_code.value = res.data.jobCode;
                                this.car.value = res.data.car;
                                loading();
                            }else{
                                loading();
                                this.$message.error(res.errmsg);
                            }
                        }).catch(e=>{
                            loading();
                            this.$message.error(e);
                        });
                        window.clearInterval(timer);
                    }
                }, 200);
            }
            // 监听经办人值变化时调用接口通过传经办人id将接口返回值赋值给收方银行:recipient_bank 和 收方银行账号:recipient_bank_code 和 对方单位名称:company_name
            this.user_name.valueChange.subscribe((change)=>{
                let loading = this.$message.loading('数据加载中...', 0);
                // 经办人变化时先置空收方银行、收方银行账号和对方单位名称
                let paramData = change.value ? change.value[0].id : null;
                this.recipient_bank.value = '';
                this.recipient_bank_code.value = '';
                this.company_name.value = '';
                this.position.value = '';
                this.job_code.value = '';
                this.car.value = '';
                this.serial_number.value = '';
                this.cost_select.value = '';
                if(change.value){
                    axios.get('http://113.12.64.58:88/api/ext/v1/bankInfo/get_staff_bank?userId=' + paramData).then((res)=>{
                        if(res && res.errcode === 0){
                            this.recipient_bank.value = res.data.bankName;
                            this.recipient_bank_code.value = res.data.bankAccount;
                            this.company_name.value = res.data.jobCode;
                            this.serial_number.value = res.data.jobCode;
                            this.job_code.value = res.data.jobCode;
                            this.position.value = res.data.position;
                            this.car.value = res.data.car;
                            loading();
                        }else{
                            loading();
                            this.$message.error(res.errmsg);
                        }
                    }).catch(e=>{
                        loading();
                        this.$message.error(e);
                    });
                }else{
                    loading();
                }
            });
            let companyId = this.company.value ? this.company.value[0].id : '';
            let departmentId = this.department.value ? this.department.value[0].id : '';
            // 页面加载后调用接口通过传所在公司部门id:将接口返回值赋值给公司代码:company_code、付方银行:pay_bank、付方银行账号:pay_bank_code
            if(!procStatus && companyId){ // 只页面加载获取，其他任何节点都不自动获取
                axios.get('http://113.12.64.58:88/api/ext/v1/bankInfo/get_company_bank?departmentId=' + companyId).then((res)=>{
                    if(res && res.errcode === 0){
                        this.company_code.value = res.data.companyCode.companyCode;
                        this.pay_bank.value = res.data.companyBanks[0].bankName;
                        this.pay_bank_code.value = res.data.companyBanks[0].bankAccount;
                    }else{
                        this.$message.error(res.errmsg);
                    }
                }).catch(e=>{
                    this.$message.error(e);
                });
            }
            // 页面加载后调用接口根据部门department、所在公司company获取对应成本中心信息
            if(!procStatus && companyId && departmentId){ // 只页面加载获取，其他任何节点都不自动获取
                axios.post(`http://113.12.64.58:88/api/ext/v1/bankInfo/get_cost_select?department=${departmentId}&company=${companyId}`).then((res)=>{
                    if(res && res.errcode === 0){
                        let resAll = res.data;
                        if(resAll){
                            costSelect.cost_center_introduce = resAll.costCenterName;
                            costSelect.cost_center = resAll.costCenterCode;
                            costSelect.profit_center = resAll.profitCenterCode;
                            this.cost_select.value = resAll.costCenterCode;
                        }else{
                            this.$message.error('请求数据不存在');
                        }
                    }else{
                        this.$message.error('接口请求异常');
                    }
                }).catch(e=>{
                    this.$message.error(e);
                });
            }
            // 监听所在公司值变化时调用接口通过传所在公司部门id将接口返回值赋值给公司代码:company_code、付方银行:pay_bank、付方银行账号:pay_bank_code
            this.company.valueChange.subscribe((change)=>{
                let loading = this.$message.loading('数据加载中...', 0);
                let companyId = change.value ? change.value[0].id : null;
                let departmentId = this.department.value ? this.department.value[0].id : null;
                // 所在公司值变化时先置空公司代码、付方银行和付方银行账号
                this.company_code.value = '';
                this.pay_bank.value = '';
                this.pay_bank_code.value = '';
                this.cost_select.value = '';
                if(companyId){
                    axios.get('http://113.12.64.58:88/api/ext/v1/bankInfo/get_company_bank?departmentId=' + companyId).then((res)=>{
                        if(res && res.errcode === 0){
                            this.company_code.value = res.data.companyCode.companyCode;
                            this.pay_bank.value = res.data.companyBanks[0].bankName;
                            this.pay_bank_code.value = res.data.companyBanks[0].bankAccount;
                        }else{
                            loading();
                            this.$message.error(res.errmsg);
                        }
                    }).catch(e=>{
                        loading();
                        this.$message.error(e);
                    });
                    // 监听所在公司值变化时调用接口根据部门department、所在公司company获取对应成本中心信息
                    if(departmentId){
                        axios.post(`http://113.12.64.58:88/api/ext/v1/bankInfo/get_cost_select?department=${departmentId}&company=${companyId}`).then((res)=>{
                            if(res && res.errcode === 0){
                                let resAll = res.data;
                                if(resAll){
                                    costSelect.cost_center_introduce = resAll.costCenterName;
                                    costSelect.cost_center = resAll.costCenterCode;
                                    costSelect.profit_center = resAll.profitCenterCode;
                                    this.cost_select.value = resAll.costCenterCode;
                                    loading();
                                }else{
                                    loading();
                                    this.$message.error('请求数据不存在');
                                }
                            }else{
                                loading();
                                this.$message.error('接口请求异常');
                            }
                        }).catch(e=>{
                            loading();
                            this.$message.error(e);
                        });
                    }
                }else{
                    loading();
                }
            });
            // 勾选报销类型为日清差旅报销:reimbursement_type并选完结束日期时，请求接口获取智慧松宇日清明细
            // http://crm.sonyu.cn:8899/api/SYCRM_GET_DAILY_TO_DINGTALK/sss
            // sss为预留流程单据号
            // token:（写死的，不会超时）
            // 传参: 员工工号:account(SY001163);开始日期:YYYY-MM-DD;结束日期:YYYY-MM-DD;
            this.apply_yearmonth.valueChange.subscribe(async (change)=>{
                let year = new Date(change.value).getFullYear();
                let month = new Date(change.value).getMonth() + 1;
                if(month < 10){
                    month = '0' + month;
                }else{
                    month = String(month);
                }
                this.days.value = new Date(year, month, 0).getDate();
                if(this.reimbursement_type.value === '日清差旅报销' || this.reimbursement_type.value === '日清招待费'){
                    // 日清差旅报销类型下请求智慧松宇接口
                    let loading = this.$message.loading('数据加载中...', 0);
                    let account = this.job_code.value;
                    if(account === ''){
                        this.$message.warning('请填写员工工号！');
                        return;
                    }
                    let apiUrl = `http://sycrm.sonyu.cn:8899/api/${this.reimbursement_type.value === '日清差旅报销' ? 'SYCRM_GET_DAILY_TO_DINGTALK/asda' : 'SYCRM_GET_ENTERTAIN_TO_DINGTALK/ssss'}/`
                    let out_token = 'JWT eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1NTY0MzE1OTMsImlzcyI6InNvbnl1IiwiZGF0YSI6eyJ1aWQiOiJTWTAwMDc4NyJ9fQ.GMcYJgG8I1ZuU84fwnL8rGJ-fly2FFjMkb9zjoX1ZL0';
                    window.localStorage.setItem('out_token', out_token);
                    axios({
                        method: 'get',
                        url: apiUrl + account + '/' + year + '/' + month,
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                            'Authorization': 'JWT eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1NTY0MzE1OTMsImlzcyI6InNvbnl1IiwiZGF0YSI6eyJ1aWQiOiJTWTAwMDc4NyJ9fQ.GMcYJgG8I1ZuU84fwnL8rGJ-fly2FFjMkb9zjoX1ZL0'
                        },
                    }).then(res=>{
                        console.log(res, '智慧松宇接口返回');
                        // 将智慧松宇接口返回值赋给费用报销合计子表:reimbursement_detail_total
                        // 将智慧松宇接口返回值赋给费用报销明细子表:reimbursement_detail
                        if(res && res.SUMS.length || res.DETAL.length){
                            let returnSums = res.SUMS;
                            let returnDetal = res.DETAL;
                            let returnSumsLength = res.SUMS.length;
                            let returnDetalLength = res.DETAL.length;
                            this.reimbursement_detail_total.value = [];
                            this.reimbursement_erp.value = [];
                            this.reimbursement_detail.value = [];
                            // 给明细子表、合计子表赋值（非123级科目）
                            let arrDetal = new Array(returnDetalLength);
                            let arrSums = new Array(returnSumsLength);
                            let resultObj1 = {};
                            resultObj1.levels = regClassTitle(returnSums);
                            let resultObj2 = {};
                            resultObj2.levels = regClassTitle(returnDetal);
                            // 费用报销合计：请求后端接口将一级二级三级费用名称传参进去返回对应的关联表单id，填充到子表各列
                            axios.post('http://113.12.64.58:88/api/ext/v1/expenses/getIdAndErp_code', resultObj1).then((res)=>{
                                if(res && res.errcode === 0){
                                    let returnData1 = res.data;
                                    let totalAmount = 0;
                                    for(let i = 0;i < returnData1.length;i++){
                                        // 费用报销合计赋值
                                        arrSums[i] = {
                                            review_amount: returnSums[i].review_amount,
                                            invoice_count: returnSums[i].invoice,
                                            cumulative: returnSums[i].count,
                                            class_code: returnSums[i].class_c_code,
                                            erp_code: returnSums[i].erp_code,
                                            expenses_first: {
                                                id: returnData1[i].firstId,
                                                expenses_name: returnData1[i].firstName
                                            },
                                            expenses_second: {
                                                id: returnData1[i].secondId,
                                                expenses_name: returnData1[i].secondName
                                            },
                                            expenses_third: {
                                                id: returnData1[i].thirdId,
                                                expenses_name: returnData1[i].thirdName
                                            }
                                        }
                                        totalAmount += returnSums[i].review_amount;
                                    }
                                    self.reimbursement_detail_total.value = arrSums;
                                    self.apply_amount.value = totalAmount;
                                }
                            }).catch(e=>{
                                this.$message.error(e);
                            });
                            // 费用报销明细：请求后端接口将一级二级三级费用名称传参进去返回对应的关联表单id，填充到子表各列
                            axios.post('http://113.12.64.58:88/api/ext/v1/expenses/getIdAndErp_code', resultObj2).then((ress)=>{
                                if(ress && ress.errcode === 0){
                                    console.log(ress, '克克接口返回2');
                                    let returnData2 = ress.data;
                                    for(let i = 0;i < returnData2.length;i++){
                                        // 费用报销明细赋值
                                        arrDetal[i] = {
                                            area: returnDetal[i].region_type ? returnDetal[i].region_type : '三类地区',
                                            review_amount: returnDetal[i].review_amount,
                                            invoice_count: returnDetal[i].invoice,
                                            expenses_describe: returnDetal[i].detail_remark,
                                            class_code: returnDetal[i].class_c_code,
                                            product_id: String(returnDetal[i].id),
                                            erp_code: returnDetal[i].erp_code,
                                            real_date: returnDetal[i].real_date,
                                            position_origin: returnDetal[i].position_origin,
                                            position_destination: returnDetal[i].position_destination,
                                            expenses_first: returnData2[i].firstName,
                                            expenses_second: returnData2[i].secondName,
                                            expenses_third: returnData2[i].thirdName
                                        }
                                    }
                                    console.log(arrDetal, 'arrDetal');
                                    self.reimbursement_detail.value = arrDetal;
                                    self.reimbursement_detail.getRowValueChange(returnData2.length - 1).subscribe((change) => {
                                        loading();
                                    });
                                }
                            }).catch(e=>{
                                this.$message.error(e);
                            });
                        }else{
                            loading();
                            this.$message.error('未获取到当前月份的数据');
                            this.reimbursement_detail_total.value = [];
                            this.reimbursement_detail.value = [];
                        }
                        window.localStorage.removeItem('out_token');
                    }).catch(e=>{
                        loading();
                        // this.$message.error(e);
                        window.localStorage.removeItem('out_token');
                    });
                }
            });
            // 监听是否生成台账凭证:if_general变化时，对台账凭证进行处理
            this.if_general.valueChange.subscribe((change)=>{
                if(change.value === '是'){
                    // 如果勾选是，将ERP应付凭证信息子表反序插入到台账凭证子表各字段
                    // 先移除默认台账凭证子表各行
                    this.general_ledger_vouche.value = [];
                    // console.log(this.reimbursement_erp.value, '1233112');
                    // 先插入一行，对应ERP应付凭证信息子表倒数第一行
                    let totalLength = this.reimbursement_erp.value.length;
                    this.general_ledger_vouche.insertRow(0,{
                        pk: '40(借方)'
                    });
                    // 再插入剩余行，对应ERP应付凭证信息子表的非倒数第一行
                    for(let i = 1;i < totalLength;i++){
                        this.general_ledger_vouche.insertRow(i,{
                            pk: this.reimbursement_erp.value[totalLength - 1].pk,
                            expenses_introduce: this.reimbursement_erp.value[i - 1].expenses_introduce,
                            ledger_account: this.reimbursement_erp.value[i - 1].ledger_account,
                            subject: this.reimbursement_erp.value[i - 1].subject,
                            line_item: this.reimbursement_erp.value[i - 1].line_item,
                            amount: this.reimbursement_erp.value[i - 1].amount !== 0 ? -this.reimbursement_erp.value[i - 1].amount : 0,
                            job_code: this.reimbursement_erp.value[i - 1].job_code,
                            tax: this.reimbursement_erp.value[i - 1].tax,
                            cost_center_introduce: this.reimbursement_erp.value[i - 1].cost_center_introduce,
                            cost_center: this.reimbursement_erp.value[i - 1].cost_center,
                            profit_center: this.reimbursement_erp.value[i - 1].profit_center,
                            special_invoice_code: this.reimbursement_erp.value[i - 1].special_invoice_code,
                            order_code: this.reimbursement_erp.value[i - 1].order_code,
                            serial_number: this.reimbursement_erp.value[i - 1].serial_number,
                            condition_type: this.reimbursement_erp.value[i - 1].condition_type,
                            materiel: this.reimbursement_erp.value[i - 1].materiel,
                            repair_code: this.reimbursement_erp.value[i - 1].repair_code,
                            commit_project: this.reimbursement_erp.value[i - 1].erp_code,
                        })
                    }
                }else{
                    this.general_ledger_vouche.value = [];
                }
            });
            // 如果勾选日清差旅报销后勾选回普通报销，清掉各子表接口返回填充的数据
            this.reimbursement_type.valueChange.subscribe((change)=>{
                if(change.value === '普通报销-非行政类' || change.value === '普通报销-行政类' || change.value === '普通报销-提成类'){
                    // 普通报销类型下天数days字段不受其它类型影响要赋值为0
                    this.days.value = 0;
                    this.days.options.visible = false;
                    this.reimbursement_detail.value = [];
                    this.reimbursement_erp.value = [];
                    this.general_ledger_vouche.value = [];
                    // 三种普通报销类型下，合计子表不可编辑且只能有一行
                    this.reimbursement_detail_total.options.editable = false;
                }else if(change.value === '日清差旅报销' || change.value === '日清招待费' || change.value === '赠送报销'){
                    this.general_ledger_vouche.value = [];
                    this.days.value = 0;
                    this.days.options.visible = true;
                    this.reimbursement_detail_total.options.editable = false;
                }else if(change.value === '销售台量招待费'){
                    this.general_ledger_vouche.value = [];
                    this.days.value = 0;
                    this.days.options.visible = true;
                    this.reimbursement_detail_total.options.editable = false;
                    // 招待费用报销类型下的各功能
                    entertainFunction(this, data.id);
                }else{
                    this.reimbursement_detail_total.options.editable = false;
                    this.days.value = 0;
                    this.days.options.visible = false;
                }
            });
            // 监听ERP子表费用说明列各值变化，点击时触发弹框
            this.reimbursement_erp.getColumnValueChange('expenses_introduce').subscribe((change)=>{
                if(procStatus === 'PROCESSING' && (self.workflowInfo.activityName === '财务中心核算经理' || self.workflowInfo.activityName === '财务中心会计')){
                    getModelClick(self, 'reimbursement_erp', 1, 0, 0);
                }
            });
            if(procStatus === 'PROCESSING' && (self.workflowInfo.activityName === '财务中心核算经理' || self.workflowInfo.activityName === '财务中心会计')){
                getModelClick(self, 'reimbursement_erp', 1, 0, 0);
            }
            // 监听台账凭证子表费用说明列各值变化，点击时触发弹框
            this.general_ledger_vouche.getColumnValueChange('expenses_introduce').subscribe((change)=>{
                if(procStatus === 'PROCESSING' && (self.workflowInfo.activityName === '财务中心核算经理' || self.workflowInfo.activityName === '财务中心会计')){
                    getModelClick(self, 'general_ledger_vouche', 1, 1, 0);
                }
            })
            if(procStatus === 'PROCESSING' && (self.workflowInfo.activityName === '财务中心核算经理' || self.workflowInfo.activityName === '财务中心会计')){
                getModelClick(self, 'general_ledger_vouche', 1, 1, 0);
            }
            // 监听ERP子表成本中心-说明列各值变化，点击时触发弹框
            this.reimbursement_erp.getColumnValueChange('cost_center_introduce').subscribe((change)=>{
                if(procStatus === 'PROCESSING' && (self.workflowInfo.activityName === '财务中心核算经理' || self.workflowInfo.activityName === '财务中心会计')){
                    getModelClick(self, 'reimbursement_erp', 9, 0, 1);
                }
            });
            if(procStatus === 'PROCESSING' && (self.workflowInfo.activityName === '财务中心核算经理' || self.workflowInfo.activityName === '财务中心会计')){
                getModelClick(self, 'reimbursement_erp', 9, 0, 1);
            }
            // 监听台账凭证子表成本中心-说明列各值变化，点击时触发弹框
            this.general_ledger_vouche.getColumnValueChange('cost_center_introduce').subscribe((change)=>{
                if(procStatus === 'PROCESSING' && (self.workflowInfo.activityName === '财务中心核算经理' || self.workflowInfo.activityName === '财务中心会计')){
                    getModelClick(self, 'general_ledger_vouche', 9, 1, 1);
                }
            });
            if(procStatus === 'PROCESSING' && (self.workflowInfo.activityName === '财务中心核算经理' || self.workflowInfo.activityName === '财务中心会计')){
                getModelClick(self, 'general_ledger_vouche', 9, 1, 1);
            }
            // 监听对方单位名称字段company_name值变化，点击时触发弹框
            this.company_name.valueChange.subscribe((change)=>{
                if(procStatus === 'PROCESSING' && (self.workflowInfo.activityName === '财务中心核算经理' || self.workflowInfo.activityName === '财务中心会计')){
                    getModelClickSpec(self);
                }
            });
            if(procStatus === 'PROCESSING' && (self.workflowInfo.activityName === '财务中心核算经理' || self.workflowInfo.activityName === '财务中心会计')){
                getModelClickSpec(self);
            }
            // 监听成本中心字段cost_select值变化，点击时触发弹框
            this.cost_select.valueChange.subscribe((change)=>{
                if(!procStatus || procStatus === 'DRAFT' && this.workflowInfo.activityName === '填写申请单'){
                    getModelClickCost(self);
                }
            });
            if(!procStatus || procStatus === 'DRAFT' && this.workflowInfo.activityName === '填写申请单'){
                getModelClickCost(self);
            }
            // 赠送报销 选择赠送类型后触发弹框选择明细子表数据
            this.giftfee_type.valueChange.subscribe((change)=>{
                let arr1 = this.giftfee_type.items;
                let arr2 = [];
                for(let i = 0;i < arr1.length;i++){
                    if(/\s/.test(arr1[i])){
                        arr2.push(arr1[i].replace(/\s+/g,""));
                    }else{
                        arr2.push(arr1[i] += ' ');                        
                    }
                }
                this.giftfee_type.items = arr2.join(';');
                if(change.value !== ''){
                    let giftType = change.value.replace(/(^\s*)|(\s*$)/g, "");
                    if(giftType){
                        postGiftFeeData(self, giftType, pageindex, pagesize, 0, '', 0);
                    }
                }
            });
            let hasAgree = false;
            let actionArr = self.actions;
            for(let i = 0;i < actionArr.length;i++){
                if(actionArr[i].code === 'agree'){
                    hasAgree = true;
                    break;
                }
            }
            if(hasAgree && self.division_approval.value === '否' && self.group_approval.value === '否'){
                let loginName = JSON.parse(window.sessionStorage.getItem('user'));
                detailToERP(self, costSelect, loginName.name);
            }
        });
        //内置校验完成后，返回false阻止提交
        form.on('onValidate',function(action,data){});
        //操作前（包含自定义按钮）执行，返回false阻止按钮操作
        form.on('onPreAction',function(action,data){
            let accountName = JSON.parse(window.sessionStorage.getItem('user'));
            if(action.code === 'save' && action.text === '提交'){
                if((procStatus === 'PROCESSING' && (this.workflowInfo.activityName === '财务中心核算经理' || this.workflowInfo.activityName === '财务中心会计')) || accountName.name === 'admin'){
                // 校验审批人
                    let flsg = false;
                    this.reimbursement_erp.value.forEach(item => {
                        if(!item.expenses_introduce){
                            flsg = true;
                            this.$message.error('erp子表费用说明不能为空');
                            return;
                        }
                        if(!item.line_item){
                            flsg = true;
                            this.$message.error('erp子表行项目文本不能为空');
                            return;
                        }
                        if(!item.amount){
                            flsg = true;
                            this.$message.error('erp子表金额不能为空');
                            return;
                        }
                        if(!item.cost_center_introduce){
                            flsg = true;
                            this.$message.error('erp子表成本中心说明不能为空');
                            return;
                        }
                    });
                    if(flsg){
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    if(this.if_general.value === '是'){
                        let flgs = false;
                        this.general_ledger_vouche.value.forEach(item => {
                            if(!item.expenses_introduce){
                                flgs = true
                                this.$message.error('台账凭证子表费用说明不能为空');
                                return;
                            }
                            if(!item.line_item){
                                flgs = true
                                this.$message.error('台账凭证子表行项目文本不能为空');
                                return;
                            }
                            if(!item.amount){
                                flgs = true
                                this.$message.error('台账凭证子表金额不能为空');
                                return;
                            }
                            if(!item.cost_center_introduce){
                                flgs = true
                                this.$message.error('台账凭证子表成本中心说明不能为空');
                                return;
                            }
                        });
                        if(flgs){
                            for(let aci = 0; aci < this.actions.length; aci++){
                                this.actions[aci].disabled = false;
                            }
                            return false;
                        }
                    }
                    if(!this.company_name.value){
                        this.$message.error('请输入对方单位名称');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    if(!this.pay_bank.value){
                        this.$message.error('请输入付方银行');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    if(!this.pay_bank_code.value){
                        this.$message.error('请输入付方银行账号');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    if(!this.actual_amount.value){
                        this.$message.error('请输入实际支付金额');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    if(!this.introduction.value){
                        this.$message.error('请输入摘要');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                }else{
                    // 校验填单人
                    if(!this.user_name.value){
                        this.$message.error('请输入经办人');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    if(!this.job_code.value){
                        this.$message.error('请输入工号');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    if(!this.department.value){
                        this.$message.error('请选择部门');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    if(!this.company.value){
                        this.$message.error('请选择所在公司');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    if(!this.position.value){
                        this.$message.error('请输入岗位');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    if(!this.cost_select.value){
                        this.$message.error('请选择成本中心');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    if(!this.recipient_bank.value){
                        this.$message.error('请输入收方银行');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    // 正则匹配到收方银行空格，去除所有空格
                    if(/\s+/g.test(this.recipient_bank.value)){
                        this.$message.error('收方银行不能有空格，请重新提交');
                        this.recipient_bank.value = this.recipient_bank.value.replace(/\s*/g,"");
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    if(!this.recipient_bank_code.value){
                        this.$message.error('请输入收方银行账号');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    // 正则匹配到收方银行账号空格，去除所有空格
                    if(/\s+/g.test(this.recipient_bank_code.value)){
                        this.$message.error('收方银行账号不能有空格，请重新提交');
                        this.recipient_bank_code.value = this.recipient_bank_code.value.replace(/\s*/g,"");
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    // 正则匹配到收方银行账号格式异常，提示
                    if(!(/^\d+$/.test(this.recipient_bank_code.value))){
                        this.$message.error('收方银行账号只能为数字，请重新输入');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    if(!this.company_code.value){
                        this.$message.error('未带出公司代码，请重新选择所在公司');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    if(!this.reimbursement_type.value){
                        this.$message.error('请选择报销类型');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }else if(this.reimbursement_type.value === '赠送报销' && !this.giftfee_type.value){
                        this.$message.error('请选择赠送费用类型');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    if(!this.apply_yearmonth.value){
                        this.$message.error('请选择申请年月');
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                    let flags = false;
                    this.reimbursement_detail_total.value.forEach(item => {
                        if(!item.expenses_first || !item.expenses_second || !item.expenses_third){
                            flags = true;
                            this.$message.error('合计子表一二三级费用不能为空');
                            return;
                        }
                        if(item.review_amount == null || item.review_amount === ''){
                            flags = true;
                            this.$message.error('合计子表申请金额不能为空');
                            return;
                        }
                    });
                    if(flags){
                        for(let aci = 0; aci < this.actions.length; aci++){
                            this.actions[aci].disabled = false;
                        }
                        return false;
                    }
                }
            }else if(action.code === 'save' && action.text === '暂存'){
                let hasAgree = false;
                let actionArr = this.actions;
                for(let i = 0;i < actionArr.length;i++){
                    if(actionArr[i].code === 'agree'){
                        hasAgree = true;
                        break;
                    }
                }
                if(hasAgree){
                    this.division_approval.value = '是';
                }
            }
            // 费控校验前将合计子表总申请金额赋值给实际支付金额字段，防止列表页非财务人员审批节点实际支付金额为空
            if(action.code !== 'agree' && this.division_approval.value === '否'){
                let totalAmountsList = this.reimbursement_detail_total.value;
                if(totalAmountsList.length > 0){
                    let totalAmountFee = 0;
                    totalAmountsList.forEach(item => {
                        if(item.review_amount){
                            totalAmountFee += item.review_amount
                        }
                    });
                    this.actual_amount.value = totalAmountFee;
                }
            }
            // 判断是否是进行中财务主办会计点同意按钮，如果点了同意按钮后再加签给别的人，存是否已财务主办会计同意为是，是的情况下，加签后不会再调用detailToERP方法
            if(action.code === 'agree' && this.workflowInfo.activityName === '财务中心会计'){
                this.group_approval.value = '是';
            }
        });
        //自定义按钮执行
        form.on('onCustomAction',function(action,data){});
        //操作完成后执行
        form.on('onActionDone',function(action,data,httpRes){
            let objectId = data.id;
            if(this.reimbursement_type.value !== '赠送报销' && this.reimbursement_type.value !== '普通报销-提成类'){
                // 非赠送费报销和非普通报销-提成类做费控校验
                if(action.code === 'save' && action.text === '提交' && httpRes.errcode === 0){
                    let beginFlag = false;
                    return axios.post('http://113.12.64.58:88/api/ext/v1/sap/getBudgetAgain?objectId=' + objectId + '&type=' + '1').then((ress) => {
                        if(ress && ress.errcode === 0){
                            if(ress.data.flag === true){
                                beginFlag = true;
                            }else{
                                this.$confirm({
                                    title: '未通过预算校验!',
                                    content: '合计表中存在预算不通过项目,请追加预算',
                                    okText: '知道了',
                                    onOk:function(){
                                        window.location.reload();
                                    },
                                    onCancel:function(){
                                        window.location.reload();
                                    }
                                });
                            }
                        }else{
                            this.$message.error(ress.errmsg);
                        }
                    }).then(() => {
                        if(beginFlag){
                            axios.get('http://113.12.64.58:88/api/ext/v1/expenses/cost_judgment?objectId=' + objectId).then((res)=>{
                                if(res && res === true){
                                    axios.get('http://113.12.64.58:88/api/ext/v1/expenses/submitWorkItem?objectId=' + objectId).then((resa)=>{
                                        if(resa && resa.errcode === 0){
                                            this.$message.success('提交成功');
                                        }else{
                                            this.$message.error(resa.errmsg);
                                        }
                                    }).then(() => {
                                        axios.get('http://113.12.64.58:88/api/ext/v1/expenses/changeState?objectId=' + objectId).then((res)=>{
                                            if(res){
                                                if(isMobile){
                                                    window.history.back();
                                                }else{
                                                    window.self.close();
                                                    window.opener.location.reload();
                                                }
                                            }
                                        }).catch(e=>{
                                            console.log(e);
                                        });
                                    }).catch(ee => {
                                        this.$message.error(ee);
                                    });
                                }else{
                                    this.$confirm({
                                        title: '未通过费控校验!',
                                        content: '请检查费用报销明细和费用报销合计未通过原因，核对后重新提交',
                                        okText: '知道了',
                                        onOk:function(){
                                            window.location.reload();
                                        },
                                        onCancel:function(){
                                            window.location.reload();
                                        }
                                    });
                                }
                            });
                        }
                    }).catch(e => {
                        this.$message.error(e);
                    });
                }
            }else{
                // 赠送费报销不做费控校验，直接提交
                if(action.code === 'save' && action.text === '提交' && httpRes.errcode === 0){
                    return axios.get('http://113.12.64.58:88/api/ext/v1/expenses/submitWorkItem?objectId=' + objectId).then((res)=>{
                        if(res && res.errcode === 0){
                            this.$message.success('提交成功');
                        }else{
                            this.$message.error(res.errmsg);
                        }
                    }).then(() => {
                        return axios.get('http://113.12.64.58:88/api/ext/v1/expenses/changeState?objectId=' + objectId).then((res)=>{
                            if(res){
                                if(isMobile){
                                    window.history.back();
                                }else{
                                    window.self.close();
                                    window.opener.location.reload();
                                }
                            }
                        }).catch(e=>{
                            console.log(e);
                        });
                    }).catch(e=>{
                        this.$message.error(e);
                    });
                }
            }
        });
    })
</script>